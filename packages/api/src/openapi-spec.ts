// Auto-generated from packages/api/openapi/openapi.yaml. Do not edit manually.
export const FULL_OPENAPI_SPEC = "openapi: 3.1.0\ninfo:\n  title: CariCash Nova API\n  version: 0.2.0\n  description: |\n    CariCash Nova — Barbados-based mobile payments platform API.\n\n    ## Key Concepts\n    - **Jurisdiction**: Barbados. Base currency: BBD. NO FX — cross-currency postings rejected.\n    - **Closed-loop wallets**: Customers, agents, and merchants hold balances internally.\n    - **Double-entry ledger**: Every transaction posts balanced journal entries (sum DR = sum CR).\n    - **Idempotency**: All money-moving endpoints require `idempotency_key`. Retries with same key+payload return cached result; same key+different payload returns 409 DUPLICATE_IDEMPOTENCY_CONFLICT.\n    - **Maker-checker**: Reversals, manual adjustments, overdraft facilities, fee/commission changes require dual approval (maker ≠ checker).\n    - **Posting via Durable Object**: All money movement routes through a serialized Durable Object per wallet-per-currency.\n  contact:\n    name: CariCash Engineering\n    email: engineering@caricash.bb\n  license:\n    name: MIT\n\nservers:\n  - url: https://api-staging.caricash.com/\n    description: Staging environment\n  - url: /\n    description: Current host\n  - url: http://localhost:8787\n    description: Local development (wrangler dev)\n\ntags:\n  - name: Auth\n    description: Authentication endpoints for all actor types\n  - name: Customers\n    description: Customer registration and KYC management\n  - name: Agents\n    description: Agent registration\n  - name: Merchants\n    description: Merchant registration\n  - name: Codes\n    description: Reservable 6-digit code generation\n  - name: Wallets\n    description: Wallet balance and statement queries\n  - name: Float\n    description: Staff-managed agent float top-up, withdrawal, and history\n  - name: Transactions\n    description: Money movement — deposit, withdrawal, P2P, payment, B2B, reversal\n  - name: Approvals\n    description: Maker-checker approval workflow\n  - name: Ops\n    description: Staff-only operational endpoints\n  - name: Reconciliation\n    description: Staff-only reconciliation and integrity verification\n  - name: Overdraft\n    description: Staff-only overdraft facility management (maker-checker)\n\nsecurity: []\n\npaths:\n  # ============================================================\n  #  AUTH\n  # ============================================================\n  /auth/customer/login:\n    post:\n      operationId: customerLogin\n      tags: [Auth]\n      summary: Customer login\n      description: Authenticate a customer using MSISDN and PIN.\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/CustomerLoginRequest'\n            example:\n              msisdn: '+12465551234'\n              pin: '1234'\n      responses:\n        '200':\n          description: Login successful\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/LoginResponse'\n              example:\n                token: '01HZ...'\n                actor_id: '01HZ...'\n                actor_type: CUSTOMER\n                session_id: '01HZ...'\n                correlation_id: '01HZ...'\n        '400':\n          $ref: '#/components/responses/ValidationError'\n        '401':\n          $ref: '#/components/responses/Unauthorized'\n        '423':\n          description: Account locked\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n        '429':\n          $ref: '#/components/responses/RateLimited'\n\n  /auth/agent/login:\n    post:\n      operationId: agentLogin\n      tags: [Auth]\n      summary: Agent login\n      description: Authenticate an agent using `agent_code` and PIN. Include `msisdn` to authenticate against `agent_users` under that agent code.\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/AgentLoginRequest'\n            example:\n              agent_code: 'AGT001'\n              msisdn: '+12465557777'\n              pin: '5678'\n      responses:\n        '200':\n          description: Login successful\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/LoginResponse'\n        '400':\n          $ref: '#/components/responses/ValidationError'\n        '401':\n          $ref: '#/components/responses/Unauthorized'\n        '423':\n          description: Account locked\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n        '429':\n          $ref: '#/components/responses/RateLimited'\n\n  /auth/merchant/login:\n    post:\n      operationId: merchantLogin\n      tags: [Auth]\n      summary: Merchant login\n      description: Authenticate a merchant using MSISDN and PIN. Optional `store_code` supports store-scoped merchant-user compatibility.\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/MerchantLoginRequest'\n            example:\n              msisdn: '+12465557777'\n              pin: '9012'\n      responses:\n        '200':\n          description: Login successful\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/LoginResponse'\n        '400':\n          $ref: '#/components/responses/ValidationError'\n        '401':\n          $ref: '#/components/responses/Unauthorized'\n        '423':\n          description: Account locked\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n        '429':\n          $ref: '#/components/responses/RateLimited'\n\n  /auth/staff/login:\n    post:\n      operationId: staffLogin\n      tags: [Auth]\n      summary: Staff login\n      description: Authenticate staff using staff_code and PIN. (OAuth stub — real IdP integration planned.)\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/StaffLoginRequest'\n            example:\n              staff_code: 'STAFF001'\n              pin: '3456'\n      responses:\n        '200':\n          description: Login successful\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/LoginResponse'\n        '400':\n          $ref: '#/components/responses/ValidationError'\n        '401':\n          $ref: '#/components/responses/Unauthorized'\n        '429':\n          $ref: '#/components/responses/RateLimited'\n\n  # ============================================================\n  #  STAFF\n  # ============================================================\n  /staff:\n    get:\n      operationId: listStaff\n      tags: [Ops]\n      summary: List staff actors\n      description: List staff members with optional state/role filters.\n      security:\n        - StaffAuth: []\n      parameters:\n        - name: state\n          in: query\n          required: false\n          schema:\n            $ref: '#/components/schemas/ActorState'\n        - name: staff_role\n          in: query\n          required: false\n          schema:\n            $ref: '#/components/schemas/StaffRole'\n        - $ref: '#/components/parameters/staffIdHeader'\n      responses:\n        '200':\n          description: Staff list\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/StaffListResponse'\n        '401':\n          $ref: '#/components/responses/StaffRequired'\n\n    post:\n      operationId: createStaff\n      tags: [Ops]\n      summary: Create staff member\n      description: Create a staff actor with login credentials.\n      security:\n        - StaffAuth: []\n      parameters:\n        - $ref: '#/components/parameters/staffIdHeader'\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/CreateStaffRequest'\n            example:\n              staff_code: 'OPS001'\n              name: 'Ops Officer'\n              email: 'ops1@caricash.bb'\n              msisdn: '+12465550001'\n              staff_role: OPERATIONS\n              pin: '3456'\n              correlation_id: '01HZ...'\n      responses:\n        '201':\n          description: Staff created\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ActorResponse'\n        '400':\n          $ref: '#/components/responses/ValidationError'\n        '401':\n          $ref: '#/components/responses/StaffRequired'\n        '403':\n          description: Insufficient privileges\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n        '409':\n          description: Duplicate staff code\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  /staff/{staffId}:\n    get:\n      operationId: getStaff\n      tags: [Ops]\n      summary: Get staff member\n      security:\n        - StaffAuth: []\n      parameters:\n        - name: staffId\n          in: path\n          required: true\n          schema:\n            type: string\n        - $ref: '#/components/parameters/staffIdHeader'\n      responses:\n        '200':\n          description: Staff actor\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ActorResponse'\n        '401':\n          $ref: '#/components/responses/StaffRequired'\n        '404':\n          $ref: '#/components/responses/NotFound'\n\n    patch:\n      operationId: updateStaff\n      tags: [Ops]\n      summary: Update staff member\n      security:\n        - StaffAuth: []\n      parameters:\n        - name: staffId\n          in: path\n          required: true\n          schema:\n            type: string\n        - $ref: '#/components/parameters/staffIdHeader'\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/UpdateStaffRequest'\n      responses:\n        '200':\n          description: Staff updated\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ActorResponse'\n        '400':\n          $ref: '#/components/responses/ValidationError'\n        '401':\n          $ref: '#/components/responses/StaffRequired'\n        '403':\n          description: Insufficient privileges\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n        '404':\n          $ref: '#/components/responses/NotFound'\n\n    delete:\n      operationId: deleteStaff\n      tags: [Ops]\n      summary: Close staff member\n      description: Soft-delete staff by setting actor state to CLOSED.\n      security:\n        - StaffAuth: []\n      parameters:\n        - name: staffId\n          in: path\n          required: true\n          schema:\n            type: string\n        - $ref: '#/components/parameters/staffIdHeader'\n      responses:\n        '200':\n          description: Staff closed\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/StaffActionResponse'\n        '401':\n          $ref: '#/components/responses/StaffRequired'\n        '403':\n          description: Insufficient privileges\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n        '404':\n          $ref: '#/components/responses/NotFound'\n\n  /staff/{staffId}/actions:\n    post:\n      operationId: staffAction\n      tags: [Ops]\n      summary: Perform staff action\n      description: Supported actions are ACTIVATE, SUSPEND, CLOSE, and UNLOCK.\n      security:\n        - StaffAuth: []\n      parameters:\n        - name: staffId\n          in: path\n          required: true\n          schema:\n            type: string\n        - $ref: '#/components/parameters/staffIdHeader'\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/StaffActionRequest'\n      responses:\n        '200':\n          description: Action applied\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/StaffActionResponse'\n        '400':\n          $ref: '#/components/responses/ValidationError'\n        '401':\n          $ref: '#/components/responses/StaffRequired'\n        '403':\n          description: Insufficient privileges\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n        '404':\n          $ref: '#/components/responses/NotFound'\n\n  /staff/{staffId}/kyc/initiate:\n    post:\n      operationId: initiateStaffKyc\n      tags: [Ops]\n      summary: Initiate staff KYC\n      security:\n        - StaffAuth: []\n      parameters:\n        - name: staffId\n          in: path\n          required: true\n          schema:\n            type: string\n        - $ref: '#/components/parameters/staffIdHeader'\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/KycInitiateRequest'\n      responses:\n        '200':\n          description: KYC initiated\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/KycInitiateResponse'\n        '400':\n          $ref: '#/components/responses/ValidationError'\n        '401':\n          $ref: '#/components/responses/StaffRequired'\n        '404':\n          $ref: '#/components/responses/NotFound'\n\n  /staff/{staffId}/kyc:\n    get:\n      operationId: getStaffKyc\n      tags: [Ops]\n      summary: Get staff KYC status\n      security:\n        - StaffAuth: []\n      parameters:\n        - name: staffId\n          in: path\n          required: true\n          schema:\n            type: string\n        - $ref: '#/components/parameters/staffIdHeader'\n      responses:\n        '200':\n          description: Staff KYC profile\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/KycProfileResponse'\n        '401':\n          $ref: '#/components/responses/StaffRequired'\n        '404':\n          $ref: '#/components/responses/NotFound'\n\n  # ============================================================\n  #  CUSTOMERS\n  # ============================================================\n  /customers:\n    post:\n      operationId: createCustomer\n      tags: [Customers]\n      summary: Register a new customer\n      description: |\n        Create a customer account with name details, preferred display name, and registration metadata.\n        Automatically creates a BBD wallet and registration metadata record.\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/CreateCustomerRequest'\n            example:\n              msisdn: '+12465559999'\n              name: 'Jane Marie Doe'\n              first_name: 'Jane'\n              middle_name: 'Marie'\n              last_name: 'Doe'\n              preferred_name: 'FIRST_NAME'\n              display_name: 'Jane'\n              registration_type: SELF_REGISTRATION\n              channel: WEB\n              terms_accepted: true\n              privacy_accepted: true\n              marketing_opt_in: false\n              pin: '1234'\n              correlation_id: '01HZ...'\n      responses:\n        '201':\n          description: Customer created\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/CreateCustomerResponse'\n        '400':\n          $ref: '#/components/responses/ValidationError'\n        '409':\n          description: Customer with this MSISDN already exists\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  /customers/{customerId}:\n    get:\n      operationId: getCustomer\n      tags: [Customers]\n      summary: Get customer details\n      description: Retrieve customer profile by ID. Returns 501 (stub).\n      parameters:\n        - $ref: '#/components/parameters/customerId'\n      responses:\n        '200':\n          description: Customer details\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ActorResponse'\n        '404':\n          $ref: '#/components/responses/NotFound'\n        '501':\n          description: Not yet implemented\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  /customers/{customerId}/kyc/initiate:\n    post:\n      operationId: initiateCustomerKyc\n      tags: [Customers]\n      summary: Initiate customer KYC\n      description: Submit KYC documents for a customer. Updates kyc_state to PENDING.\n      parameters:\n        - $ref: '#/components/parameters/customerId'\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/KycInitiateRequest'\n            example:\n              document_type: 'NATIONAL_ID'\n              document_number: 'BB123456'\n              correlation_id: '01HZ...'\n      responses:\n        '200':\n          description: KYC initiated\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/KycInitiateResponse'\n        '400':\n          $ref: '#/components/responses/ValidationError'\n\n  /customers/{customerId}/kyc:\n    get:\n      operationId: getCustomerKyc\n      tags: [Customers]\n      summary: Get customer KYC status\n      description: Retrieve KYC status for a customer. Returns 501 (stub).\n      parameters:\n        - $ref: '#/components/parameters/customerId'\n      responses:\n        '200':\n          description: KYC profile\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/KycProfileResponse'\n        '501':\n          description: Not yet implemented\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  # ============================================================\n  #  AGENTS\n  # ============================================================\n  /agents:\n    post:\n      operationId: createAgent\n      tags: [Agents]\n      summary: Register a new agent\n      description: |\n        Create an agent actor and register an `agent_owner` user for that agent.\n        - `agent_code` is optional and can be selected from `/codes/generate`.\n        - `agent_type` can be `STANDARD` or `AGGREGATOR`.\n        - `parent_aggregator_id` links a STANDARD child agent to an AGGREGATOR parent.\n        Automatically creates WALLET + CASH_FLOAT accounts.\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/CreateAgentRequest'\n            example:\n              agent_code: '284761'\n              name: 'Agent Smith'\n              owner_name: 'Agent Smith'\n              msisdn: '+12465558888'\n              pin: '5678'\n              agent_type: 'STANDARD'\n              parent_aggregator_id: '01HZ...'\n              correlation_id: '01HZ...'\n      responses:\n        '201':\n          description: Agent created\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/CreateAgentResponse'\n        '400':\n          $ref: '#/components/responses/ValidationError'\n        '409':\n          description: Agent with this code already exists\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  /agents/{agentId}:\n    get:\n      operationId: getAgent\n      tags: [Agents]\n      summary: Get agent details\n      description: Retrieve agent profile by ID. Returns 501 (stub).\n      parameters:\n        - $ref: '#/components/parameters/agentId'\n      responses:\n        '200':\n          description: Agent details\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ActorResponse'\n        '501':\n          description: Not yet implemented\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  /agents/{agentId}/kyc/initiate:\n    post:\n      operationId: initiateAgentKyc\n      tags: [Agents]\n      summary: Initiate agent KYC\n      description: Submit KYC documents for an agent. Returns 501 (stub).\n      parameters:\n        - $ref: '#/components/parameters/agentId'\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/KycInitiateRequest'\n      responses:\n        '200':\n          description: KYC initiated\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/KycInitiateResponse'\n        '501':\n          description: Not yet implemented\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  /agents/{agentId}/kyc:\n    get:\n      operationId: getAgentKyc\n      tags: [Agents]\n      summary: Get agent KYC status\n      description: Retrieve KYC status for an agent. Returns 501 (stub).\n      parameters:\n        - $ref: '#/components/parameters/agentId'\n      responses:\n        '200':\n          description: KYC profile\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/KycProfileResponse'\n        '501':\n          description: Not yet implemented\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  # ============================================================\n  #  MERCHANTS\n  # ============================================================\n  /merchants:\n    post:\n      operationId: createMerchant\n      tags: [Merchants]\n      summary: Register a new merchant\n      description: Create a merchant business entity (without store code). Store branches are created separately under `/merchants/{merchantId}/stores`.\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/CreateMerchantRequest'\n            example:\n              name: 'Bob Shop'\n              owner_name: 'Bob Owner'\n              msisdn: '+12465557777'\n              pin: '9012'\n              correlation_id: '01HZ...'\n      responses:\n        '201':\n          description: Merchant created\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/CreateMerchantResponse'\n        '400':\n          $ref: '#/components/responses/ValidationError'\n        '409':\n          description: Merchant with this phone number already exists\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  /merchants/{merchantId}:\n    get:\n      operationId: getMerchant\n      tags: [Merchants]\n      summary: Get merchant details\n      description: Retrieve merchant profile by ID. Returns 501 (stub).\n      parameters:\n        - $ref: '#/components/parameters/merchantId'\n      responses:\n        '200':\n          description: Merchant details\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ActorResponse'\n        '501':\n          description: Not yet implemented\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  /merchants/{merchantId}/kyc/initiate:\n    post:\n      operationId: initiateMerchantKyc\n      tags: [Merchants]\n      summary: Initiate merchant KYC\n      description: Submit KYC documents for a merchant. Returns 501 (stub).\n      parameters:\n        - $ref: '#/components/parameters/merchantId'\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/KycInitiateRequest'\n      responses:\n        '200':\n          description: KYC initiated\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/KycInitiateResponse'\n        '501':\n          description: Not yet implemented\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  /merchants/{merchantId}/kyc:\n    get:\n      operationId: getMerchantKyc\n      tags: [Merchants]\n      summary: Get merchant KYC status\n      description: Retrieve KYC status for a merchant. Returns 501 (stub).\n      parameters:\n        - $ref: '#/components/parameters/merchantId'\n      responses:\n        '200':\n          description: KYC profile\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/KycProfileResponse'\n        '501':\n          description: Not yet implemented\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  /merchants/{merchantId}/stores:\n    post:\n      operationId: createMerchantStore\n      tags: [Merchants]\n      summary: Create a store for merchant\n      description: Add a store branch under an existing merchant. Store code can be selected from `/codes/generate` or auto-generated by the server.\n      parameters:\n        - $ref: '#/components/parameters/merchantId'\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/CreateStoreRequest'\n      responses:\n        '201':\n          description: Store created\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/CreateStoreResponse'\n        '400':\n          $ref: '#/components/responses/ValidationError'\n        '403':\n          description: Selected store code is reserved for another merchant\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n        '404':\n          $ref: '#/components/responses/NotFound'\n        '409':\n          description: Selected code unavailable or merchant conflict\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n    get:\n      operationId: listMerchantStores\n      tags: [Merchants]\n      summary: List merchant stores\n      description: List stores belonging to a merchant. Returns 501 (stub).\n      parameters:\n        - $ref: '#/components/parameters/merchantId'\n      responses:\n        '200':\n          description: Store list\n          content:\n            application/json:\n              schema:\n                type: object\n                properties:\n                  items:\n                    type: array\n                    items:\n                      type: object\n                      properties:\n                        store_id:\n                          type: string\n                        store_code:\n                          type: string\n                        name:\n                          type: string\n        '501':\n          description: Not yet implemented\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  /stores/{storeId}:\n    get:\n      operationId: getStore\n      tags: [Merchants]\n      summary: Get store details\n      description: Retrieve store details by ID. Returns 501 (stub).\n      parameters:\n        - name: storeId\n          in: path\n          required: true\n          schema:\n            type: string\n      responses:\n        '200':\n          description: Store details\n          content:\n            application/json:\n              schema:\n                type: object\n                properties:\n                  store_id:\n                    type: string\n                  store_code:\n                    type: string\n                  merchant_id:\n                    type: string\n                  name:\n                    type: string\n        '501':\n          description: Not yet implemented\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  # ============================================================\n  #  CODES\n  # ============================================================\n  /codes/generate:\n    post:\n      operationId: generateCodes\n      tags: [Codes]\n      summary: Generate and reserve selectable codes\n      description: |\n        Generates and reserves unique 6-digit codes for a short TTL.\n        - `AGENT`: staff can request selectable agent codes.\n        - `STORE`: requires `merchant_id`, and reserves codes for that merchant.\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/GenerateCodesRequest'\n            example:\n              code_type: STORE\n              merchant_id: '01HZ...'\n              count: 5\n              ttl_minutes: 30\n      responses:\n        '200':\n          description: Codes reserved successfully\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/GenerateCodesResponse'\n        '400':\n          $ref: '#/components/responses/ValidationError'\n        '404':\n          description: Merchant not found (STORE mode)\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  # ============================================================\n  #  WALLETS / BALANCES\n  # ============================================================\n  /wallets/{ownerType}/{ownerId}/{currency}/balance:\n    get:\n      operationId: getWalletBalance\n      tags: [Wallets]\n      summary: Get wallet balance\n      description: |\n        Retrieve current balance for a wallet. Balance is derived from the append-only ledger\n        (sum of credits minus sum of debits on the account).\n      parameters:\n        - name: ownerType\n          in: path\n          required: true\n          schema:\n            $ref: '#/components/schemas/OwnerType'\n        - name: ownerId\n          in: path\n          required: true\n          schema:\n            type: string\n        - name: currency\n          in: path\n          required: true\n          schema:\n            $ref: '#/components/schemas/CurrencyCode'\n      responses:\n        '200':\n          description: Balance response\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/BalanceResponse'\n              example:\n                owner_type: CUSTOMER\n                owner_id: '01HZ...'\n                currency: BBD\n                account_id: '01HZ...'\n                balance: '1000.00'\n                actual_balance: '1000.00'\n                available_balance: '970.00'\n                hold_amount: '30.00'\n                pending_credits: '0.00'\n                correlation_id: '01HZ...'\n        '404':\n          $ref: '#/components/responses/NotFound'\n\n  /wallets/{ownerType}/{ownerId}/{currency}/all-balances:\n    get:\n      operationId: getAllWalletBalances\n      tags: [Wallets]\n      summary: Get all account balances for an owner\n      description: |\n        Retrieve balances across all account types (e.g. WALLET, CASH_FLOAT, COMMISSIONS_PAYABLE)\n        for the specified owner and currency.\n      parameters:\n        - name: ownerType\n          in: path\n          required: true\n          schema:\n            $ref: '#/components/schemas/OwnerType'\n        - name: ownerId\n          in: path\n          required: true\n          schema:\n            type: string\n        - name: currency\n          in: path\n          required: true\n          schema:\n            $ref: '#/components/schemas/CurrencyCode'\n      responses:\n        '200':\n          description: All balances response\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/AllBalancesResponse'\n        '500':\n          description: Internal server error\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  /wallets/{ownerType}/{ownerId}/{currency}/statement:\n    get:\n      operationId: getWalletStatement\n      tags: [Wallets]\n      summary: Get wallet statement\n      description: Retrieve transaction history for a wallet. Returns 501 (stub).\n      parameters:\n        - name: ownerType\n          in: path\n          required: true\n          schema:\n            $ref: '#/components/schemas/OwnerType'\n        - name: ownerId\n          in: path\n          required: true\n          schema:\n            type: string\n        - name: currency\n          in: path\n          required: true\n          schema:\n            $ref: '#/components/schemas/CurrencyCode'\n        - $ref: '#/components/parameters/cursor'\n        - $ref: '#/components/parameters/pageSize'\n      responses:\n        '200':\n          description: Statement\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/StatementResponse'\n        '501':\n          description: Not yet implemented\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  # ============================================================\n  #  FLOAT MANAGEMENT\n  # ============================================================\n  /float/top-up:\n    post:\n      operationId: floatTopUp\n      tags: [Float]\n      summary: Top-up agent float\n      description: |\n        Staff deposits float into an agent's `CASH_FLOAT` account.\n        Posts a double-entry journal (system suspense -> agent cash float), updates account balances,\n        and records an auditable float operation.\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/FloatTopUpRequest'\n            example:\n              agent_code: AGT001\n              amount: '500.00'\n              currency: BBD\n              staff_id: '01HZ...'\n              reason: Branch float replenishment\n              reference: BANK-DEP-1289\n              idempotency_key: float-topup-001\n              correlation_id: '01HZ...'\n      responses:\n        '201':\n          description: Float top-up posted\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/FloatOperationResponse'\n        '400':\n          $ref: '#/components/responses/ValidationError'\n        '403':\n          description: Staff not found or unauthorized\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n        '404':\n          $ref: '#/components/responses/NotFound'\n        '409':\n          description: Idempotency conflict\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  /float/withdrawal:\n    post:\n      operationId: floatWithdrawal\n      tags: [Float]\n      summary: Withdraw agent float\n      description: |\n        Staff withdraws float from an agent's `CASH_FLOAT` account back to system suspense.\n        Records a float operation and emits float withdrawal events.\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/FloatWithdrawalRequest'\n            example:\n              agent_code: AGT001\n              amount: '200.00'\n              currency: BBD\n              staff_id: '01HZ...'\n              reason: End-of-day settlement\n              reference: BANK-WDL-778\n              idempotency_key: float-withdrawal-001\n              correlation_id: '01HZ...'\n      responses:\n        '201':\n          description: Float withdrawal posted\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/FloatOperationResponse'\n        '400':\n          $ref: '#/components/responses/ValidationError'\n        '403':\n          description: Staff not found or unauthorized\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n        '404':\n          $ref: '#/components/responses/NotFound'\n        '409':\n          description: Idempotency conflict\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  /float/{agentCode}/balance:\n    get:\n      operationId: getAgentFloatBalance\n      tags: [Float]\n      summary: Get agent float balance\n      description: Retrieve current actual and available float balances for the agent.\n      parameters:\n        - name: agentCode\n          in: path\n          required: true\n          schema:\n            type: string\n        - name: currency\n          in: query\n          required: false\n          schema:\n            $ref: '#/components/schemas/CurrencyCode'\n      responses:\n        '200':\n          description: Agent float balance\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/FloatBalanceResponse'\n        '404':\n          $ref: '#/components/responses/NotFound'\n\n  /float/{agentCode}/history:\n    get:\n      operationId: getAgentFloatHistory\n      tags: [Float]\n      summary: Get agent float operation history\n      description: List float top-up and withdrawal operations for an agent.\n      parameters:\n        - name: agentCode\n          in: path\n          required: true\n          schema:\n            type: string\n        - name: limit\n          in: query\n          required: false\n          schema:\n            type: integer\n            minimum: 1\n            maximum: 200\n            default: 50\n      responses:\n        '200':\n          description: Float operation history\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/FloatHistoryResponse'\n        '404':\n          $ref: '#/components/responses/NotFound'\n\n  # ============================================================\n  #  TRANSACTIONS\n  # ============================================================\n  /tx/agent/{agent_id}/summary:\n    get:\n      operationId: getAgentTransactionSummary\n      tags: [Transactions]\n      summary: Get agent transaction summary\n      description: |\n        Return transaction summary metrics for an agent cash-float account for the selected currency.\n        Includes today's deposits, withdrawals (cash-out), transaction count, and current balances.\n      parameters:\n        - name: agent_id\n          in: path\n          required: true\n          schema:\n            type: string\n        - name: currency\n          in: query\n          required: false\n          schema:\n            $ref: '#/components/schemas/CurrencyCode'\n          description: Currency code (defaults to BBD)\n      responses:\n        '200':\n          description: Agent transaction summary\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/AgentTransactionSummaryResponse'\n        '400':\n          $ref: '#/components/responses/ValidationError'\n        '404':\n          $ref: '#/components/responses/NotFound'\n        '500':\n          description: Internal server error\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  /tx/deposit:\n    post:\n      operationId: createDeposit\n      tags: [Transactions]\n      summary: Agent deposit (cash-in)\n      description: |\n        Agent deposits cash into a customer's wallet. Debits agent cash float, credits customer wallet.\n        Fees and commissions applied based on active fee/commission matrix.\n\n        **Idempotency**: Required. Same `idempotency_key` with same payload returns cached receipt.\n        Same key with different payload returns 409 DUPLICATE_IDEMPOTENCY_CONFLICT.\n\n        **Posting**: Routed through Durable Object for serialized access.\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/DepositRequest'\n            example:\n              agent_id: '01HZ...'\n              customer_msisdn: '+12465551234'\n              amount: '500.00'\n              currency: BBD\n              idempotency_key: 'dep-001'\n              correlation_id: '01HZ...'\n      responses:\n        '201':\n          description: Deposit posted\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/TransactionReceipt'\n        '400':\n          $ref: '#/components/responses/ValidationError'\n        '404':\n          $ref: '#/components/responses/NotFound'\n        '409':\n          description: Idempotency conflict or insufficient funds\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n        '422':\n          description: Unbalanced journal or cross-currency attempt\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  /tx/withdrawal:\n    post:\n      operationId: createWithdrawal\n      tags: [Transactions]\n      summary: Agent withdrawal (cash-out)\n      description: |\n        Agent withdraws cash from a customer's wallet. Debits customer wallet, credits agent cash float.\n\n        **Idempotency**: Required. **Posting**: Via Durable Object.\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/WithdrawalRequest'\n            example:\n              agent_id: '01HZ...'\n              customer_msisdn: '+12465551234'\n              amount: '200.00'\n              currency: BBD\n              idempotency_key: 'wdl-001'\n              correlation_id: '01HZ...'\n      responses:\n        '201':\n          description: Withdrawal posted\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/TransactionReceipt'\n        '400':\n          $ref: '#/components/responses/ValidationError'\n        '404':\n          $ref: '#/components/responses/NotFound'\n        '409':\n          description: Idempotency conflict or insufficient funds\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  /tx/p2p:\n    post:\n      operationId: createP2P\n      tags: [Transactions]\n      summary: Peer-to-peer transfer\n      description: |\n        Transfer between two customer wallets. Debits sender, credits receiver.\n\n        **Idempotency**: Required. **Posting**: Via Durable Object.\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/P2PRequest'\n            example:\n              sender_msisdn: '+12465551111'\n              receiver_msisdn: '+12465552222'\n              amount: '100.00'\n              currency: BBD\n              idempotency_key: 'p2p-001'\n              correlation_id: '01HZ...'\n      responses:\n        '201':\n          description: P2P transfer posted\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/TransactionReceipt'\n        '400':\n          $ref: '#/components/responses/ValidationError'\n        '404':\n          $ref: '#/components/responses/NotFound'\n        '409':\n          description: Idempotency conflict or insufficient funds\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  /tx/payment:\n    post:\n      operationId: createPayment\n      tags: [Transactions]\n      summary: Customer payment to merchant\n      description: |\n        Customer pays a merchant. Debits customer wallet, credits merchant wallet.\n\n        **Idempotency**: Required. **Posting**: Via Durable Object.\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/PaymentRequest'\n            example:\n              customer_msisdn: '+12465551234'\n              store_code: 'STORE001'\n              amount: '75.00'\n              currency: BBD\n              idempotency_key: 'pay-001'\n              correlation_id: '01HZ...'\n      responses:\n        '201':\n          description: Payment posted\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/TransactionReceipt'\n        '400':\n          $ref: '#/components/responses/ValidationError'\n        '404':\n          $ref: '#/components/responses/NotFound'\n        '409':\n          description: Idempotency conflict or insufficient funds\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  /tx/b2b:\n    post:\n      operationId: createB2B\n      tags: [Transactions]\n      summary: Business-to-business transfer\n      description: |\n        Transfer between two merchant wallets. Debits sender merchant, credits receiver merchant.\n\n        **Idempotency**: Required. **Posting**: Via Durable Object.\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/B2BRequest'\n            example:\n              sender_store_code: 'STORE001'\n              receiver_store_code: 'STORE002'\n              amount: '1000.00'\n              currency: BBD\n              idempotency_key: 'b2b-001'\n              correlation_id: '01HZ...'\n      responses:\n        '201':\n          description: B2B transfer posted\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/TransactionReceipt'\n        '400':\n          $ref: '#/components/responses/ValidationError'\n        '404':\n          $ref: '#/components/responses/NotFound'\n        '409':\n          description: Idempotency conflict or insufficient funds\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  /tx/reversal/request:\n    post:\n      operationId: requestReversal\n      tags: [Transactions]\n      summary: Request transaction reversal\n      description: |\n        Request reversal of a previous transaction. Creates a maker-checker approval request.\n        The reversal is NOT executed until approved by a different staff member.\n\n        **Maker-checker**: Required. Maker cannot approve their own request.\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/ReversalRequest'\n            example:\n              original_journal_id: '01HZ...'\n              reason: 'Customer requested reversal — incorrect amount'\n              staff_id: '01HZ...'\n              idempotency_key: 'rev-001'\n              correlation_id: '01HZ...'\n      responses:\n        '201':\n          description: Reversal request created (PENDING approval)\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ReversalRequestResponse'\n              example:\n                request_id: '01HZ...'\n                state: PENDING\n                correlation_id: '01HZ...'\n        '400':\n          $ref: '#/components/responses/ValidationError'\n\n  /tx/{journalId}:\n    get:\n      operationId: getTransaction\n      tags: [Transactions]\n      summary: Get transaction details\n      description: Retrieve journal details by ID. Returns 501 (stub).\n      parameters:\n        - name: journalId\n          in: path\n          required: true\n          schema:\n            type: string\n      responses:\n        '200':\n          description: Transaction details\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/JournalResponse'\n        '501':\n          description: Not yet implemented\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  /tx:\n    get:\n      operationId: listTransactions\n      tags: [Transactions]\n      summary: List transactions\n      description: List transactions with optional filters. Returns 501 (stub).\n      parameters:\n        - name: ownerType\n          in: query\n          schema:\n            $ref: '#/components/schemas/OwnerType'\n        - name: ownerId\n          in: query\n          schema:\n            type: string\n        - name: currency\n          in: query\n          schema:\n            $ref: '#/components/schemas/CurrencyCode'\n        - $ref: '#/components/parameters/cursor'\n        - $ref: '#/components/parameters/pageSize'\n      responses:\n        '200':\n          description: Transaction list\n          content:\n            application/json:\n              schema:\n                type: object\n                properties:\n                  items:\n                    type: array\n                    items:\n                      $ref: '#/components/schemas/JournalResponse'\n                  nextCursor:\n                    type: string\n                    nullable: true\n        '501':\n          description: Not yet implemented\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  # ============================================================\n  #  APPROVALS\n  # ============================================================\n  /approvals/{approvalId}/approve:\n    post:\n      operationId: approveRequest\n      tags: [Approvals]\n      summary: Approve a request\n      description: |\n        Approve a pending maker-checker request. The checker (approver) must be different from the maker.\n\n        If the approval is for a REVERSAL_REQUESTED, the reversal is automatically posted upon approval.\n      parameters:\n        - $ref: '#/components/parameters/approvalId'\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/ApprovalActionRequest'\n            example:\n              staff_id: '01HZ_CHECKER...'\n              correlation_id: '01HZ...'\n      responses:\n        '200':\n          description: Request approved\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ApprovalActionResponse'\n        '400':\n          $ref: '#/components/responses/ValidationError'\n        '403':\n          description: Maker cannot approve own request\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n        '404':\n          $ref: '#/components/responses/NotFound'\n        '409':\n          description: Request already decided\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  /approvals/{approvalId}/reject:\n    post:\n      operationId: rejectRequest\n      tags: [Approvals]\n      summary: Reject a request\n      description: Reject a pending maker-checker request.\n      parameters:\n        - $ref: '#/components/parameters/approvalId'\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/ApprovalRejectRequest'\n            example:\n              staff_id: '01HZ_CHECKER...'\n              reason: 'Amount too large without supporting docs'\n              correlation_id: '01HZ...'\n      responses:\n        '200':\n          description: Request rejected\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ApprovalActionResponse'\n        '400':\n          $ref: '#/components/responses/ValidationError'\n        '404':\n          $ref: '#/components/responses/NotFound'\n        '409':\n          description: Request already decided\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  /approvals:\n    get:\n      operationId: listApprovals\n      tags: [Approvals]\n      summary: List approval requests\n      description: List approval requests with optional status/type filters.\n      parameters:\n        - name: status\n          in: query\n          schema:\n            $ref: '#/components/schemas/ApprovalStatus'\n        - name: type\n          in: query\n          schema:\n            $ref: '#/components/schemas/ApprovalType'\n        - $ref: '#/components/parameters/cursor'\n        - $ref: '#/components/parameters/pageSize'\n      responses:\n        '200':\n          description: Approval list\n          content:\n            application/json:\n              schema:\n                type: object\n                properties:\n                  items:\n                    type: array\n                    items:\n                      $ref: '#/components/schemas/ApprovalResponse'\n                  nextCursor:\n                    type: string\n                    nullable: true\n        '500':\n          description: Internal server error\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  /approvals/{approvalId}:\n    get:\n      operationId: getApproval\n      tags: [Approvals]\n      summary: Get approval details\n      description: Retrieve a specific approval request by ID.\n      parameters:\n        - $ref: '#/components/parameters/approvalId'\n      responses:\n        '200':\n          description: Approval details\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ApprovalResponse'\n        '404':\n          $ref: '#/components/responses/NotFound'\n        '500':\n          description: Internal server error\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  /approvals/types:\n    get:\n      operationId: listApprovalTypes\n      tags: [Approvals]\n      summary: List all approval types\n      description: Returns all registered approval types — both code-level handlers and dynamic type configs.\n      responses:\n        '200':\n          description: Approval types list\n          content:\n            application/json:\n              schema:\n                type: object\n                properties:\n                  types:\n                    type: array\n                    items:\n                      $ref: '#/components/schemas/ApprovalTypeInfo'\n\n  # ============================================================\n  #  APPROVAL POLICIES\n  # ============================================================\n  /approvals/policies:\n    get:\n      operationId: listApprovalPolicies\n      tags: [Approvals]\n      summary: List approval policies\n      description: List all approval policies with optional filters.\n      parameters:\n        - name: approval_type\n          in: query\n          schema:\n            type: string\n        - name: state\n          in: query\n          schema:\n            type: string\n            enum: [DRAFT, ACTIVE, INACTIVE, ARCHIVED]\n      responses:\n        '200':\n          description: Policy list\n          content:\n            application/json:\n              schema:\n                type: object\n                properties:\n                  items:\n                    type: array\n                    items:\n                      $ref: '#/components/schemas/ApprovalPolicyFull'\n    post:\n      operationId: createApprovalPolicy\n      tags: [Approvals]\n      summary: Create approval policy\n      description: Create a new approval policy with conditions, stages, and bindings.\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/CreateApprovalPolicyRequest'\n      responses:\n        '201':\n          description: Policy created\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ApprovalPolicyFull'\n        '400':\n          $ref: '#/components/responses/ValidationError'\n\n  /approvals/policies/{policyId}:\n    get:\n      operationId: getApprovalPolicy\n      tags: [Approvals]\n      summary: Get approval policy\n      description: Retrieve a specific approval policy with full details.\n      parameters:\n        - $ref: '#/components/parameters/policyId'\n      responses:\n        '200':\n          description: Policy details\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ApprovalPolicyFull'\n        '404':\n          $ref: '#/components/responses/NotFound'\n    patch:\n      operationId: updateApprovalPolicy\n      tags: [Approvals]\n      summary: Update approval policy\n      description: Update an existing approval policy.\n      parameters:\n        - $ref: '#/components/parameters/policyId'\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              type: object\n              required: [staff_id]\n              properties:\n                staff_id:\n                  type: string\n                name:\n                  type: string\n                description:\n                  type: string\n                priority:\n                  type: integer\n                conditions:\n                  type: array\n                  items:\n                    $ref: '#/components/schemas/PolicyConditionInput'\n                stages:\n                  type: array\n                  items:\n                    $ref: '#/components/schemas/PolicyStageInput'\n                bindings:\n                  type: array\n                  items:\n                    $ref: '#/components/schemas/PolicyBindingInput'\n      responses:\n        '200':\n          description: Policy updated\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ApprovalPolicyFull'\n        '400':\n          $ref: '#/components/responses/ValidationError'\n        '404':\n          $ref: '#/components/responses/NotFound'\n    delete:\n      operationId: deleteApprovalPolicy\n      tags: [Approvals]\n      summary: Delete approval policy\n      description: Delete an approval policy (must be in DRAFT or INACTIVE state).\n      parameters:\n        - $ref: '#/components/parameters/policyId'\n        - name: staff_id\n          in: query\n          required: true\n          schema:\n            type: string\n      responses:\n        '200':\n          description: Policy deleted\n          content:\n            application/json:\n              schema:\n                type: object\n                properties:\n                  deleted:\n                    type: boolean\n                  policy_id:\n                    type: string\n        '400':\n          $ref: '#/components/responses/ValidationError'\n        '404':\n          $ref: '#/components/responses/NotFound'\n\n  /approvals/policies/{policyId}/activate:\n    post:\n      operationId: activateApprovalPolicy\n      tags: [Approvals]\n      summary: Activate approval policy\n      description: Set the policy state to ACTIVE.\n      parameters:\n        - $ref: '#/components/parameters/policyId'\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              type: object\n              required: [staff_id]\n              properties:\n                staff_id:\n                  type: string\n      responses:\n        '200':\n          description: Policy activated\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ApprovalPolicyFull'\n        '404':\n          $ref: '#/components/responses/NotFound'\n\n  /approvals/policies/{policyId}/deactivate:\n    post:\n      operationId: deactivateApprovalPolicy\n      tags: [Approvals]\n      summary: Deactivate approval policy\n      description: Set the policy state to INACTIVE.\n      parameters:\n        - $ref: '#/components/parameters/policyId'\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              type: object\n              required: [staff_id]\n              properties:\n                staff_id:\n                  type: string\n      responses:\n        '200':\n          description: Policy deactivated\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ApprovalPolicyFull'\n        '404':\n          $ref: '#/components/responses/NotFound'\n\n  /approvals/policies/simulate:\n    post:\n      operationId: simulateApprovalPolicy\n      tags: [Approvals]\n      summary: Simulate policy evaluation\n      description: Dry-run policy matching without creating a request. Returns which policy would match and the resulting stages.\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              type: object\n              required: [approval_type, payload]\n              properties:\n                approval_type:\n                  type: string\n                maker_id:\n                  type: string\n                payload:\n                  type: object\n                  additionalProperties: true\n      responses:\n        '200':\n          description: Simulation result\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/PolicyEvaluationResult'\n\n  /approvals/policies/requests/{requestId}/policy-decision:\n    get:\n      operationId: getPolicyDecision\n      tags: [Approvals]\n      summary: Get policy decision for a request\n      description: Retrieve the policy evaluation that was recorded when the request was created.\n      parameters:\n        - name: requestId\n          in: path\n          required: true\n          schema:\n            type: string\n      responses:\n        '200':\n          description: Policy decision\n          content:\n            application/json:\n              schema:\n                type: object\n                properties:\n                  request_id:\n                    type: string\n                  evaluation:\n                    $ref: '#/components/schemas/PolicyEvaluationResult'\n        '404':\n          $ref: '#/components/responses/NotFound'\n\n  # ============================================================\n  #  APPROVAL DELEGATIONS\n  # ============================================================\n  /approvals/delegations:\n    get:\n      operationId: listApprovalDelegations\n      tags: [Approvals]\n      summary: List delegations\n      description: List approval delegations with optional filters.\n      parameters:\n        - name: delegator_id\n          in: query\n          schema:\n            type: string\n        - name: delegate_id\n          in: query\n          schema:\n            type: string\n        - name: state\n          in: query\n          schema:\n            type: string\n            enum: [ACTIVE, REVOKED, EXPIRED]\n      responses:\n        '200':\n          description: Delegation list\n          content:\n            application/json:\n              schema:\n                type: object\n                properties:\n                  items:\n                    type: array\n                    items:\n                      $ref: '#/components/schemas/ApprovalDelegation'\n    post:\n      operationId: createApprovalDelegation\n      tags: [Approvals]\n      summary: Create a delegation\n      description: Delegate approval authority to another staff member for a time window.\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/CreateDelegationRequest'\n      responses:\n        '201':\n          description: Delegation created\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ApprovalDelegation'\n        '400':\n          $ref: '#/components/responses/ValidationError'\n\n  /approvals/delegations/{delegationId}/revoke:\n    post:\n      operationId: revokeApprovalDelegation\n      tags: [Approvals]\n      summary: Revoke a delegation\n      description: Revoke an active delegation.\n      parameters:\n        - name: delegationId\n          in: path\n          required: true\n          schema:\n            type: string\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              type: object\n              required: [staff_id]\n              properties:\n                staff_id:\n                  type: string\n      responses:\n        '200':\n          description: Delegation revoked\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ApprovalDelegation'\n        '404':\n          $ref: '#/components/responses/NotFound'\n        '409':\n          description: Delegation is not in ACTIVE state\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  # ============================================================\n  #  APPROVAL TYPE CONFIGS\n  # ============================================================\n  /approvals/types/config:\n    get:\n      operationId: listApprovalTypeConfigs\n      tags: [Approvals]\n      summary: List approval type configs\n      description: List all dynamic approval type configurations.\n      parameters:\n        - name: enabled_only\n          in: query\n          schema:\n            type: string\n            enum: ['true', 'false']\n      responses:\n        '200':\n          description: Type config list\n          content:\n            application/json:\n              schema:\n                type: object\n                properties:\n                  items:\n                    type: array\n                    items:\n                      $ref: '#/components/schemas/ApprovalTypeConfig'\n    post:\n      operationId: createApprovalTypeConfig\n      tags: [Approvals]\n      summary: Create approval type config\n      description: Define a new approval type at runtime.\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/CreateTypeConfigRequest'\n      responses:\n        '201':\n          description: Type config created\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ApprovalTypeConfig'\n        '400':\n          $ref: '#/components/responses/ValidationError'\n        '409':\n          description: Type key already exists\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  /approvals/types/config/{typeKey}:\n    get:\n      operationId: getApprovalTypeConfig\n      tags: [Approvals]\n      summary: Get approval type config\n      description: Retrieve a specific type config by key.\n      parameters:\n        - $ref: '#/components/parameters/typeKey'\n      responses:\n        '200':\n          description: Type config details\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ApprovalTypeConfig'\n        '404':\n          $ref: '#/components/responses/NotFound'\n    patch:\n      operationId: updateApprovalTypeConfig\n      tags: [Approvals]\n      summary: Update approval type config\n      description: Update an existing type config.\n      parameters:\n        - $ref: '#/components/parameters/typeKey'\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              type: object\n              required: [staff_id]\n              properties:\n                staff_id:\n                  type: string\n                label:\n                  type: string\n                description:\n                  type: string\n                default_checker_roles:\n                  type: array\n                  items:\n                    type: string\n                require_reason:\n                  type: boolean\n                auto_policy_id:\n                  type: string\n                  nullable: true\n                enabled:\n                  type: boolean\n      responses:\n        '200':\n          description: Type config updated\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ApprovalTypeConfig'\n        '404':\n          $ref: '#/components/responses/NotFound'\n    delete:\n      operationId: deleteApprovalTypeConfig\n      tags: [Approvals]\n      summary: Delete approval type config\n      description: Delete a type config. Cannot delete built-in types with code handlers.\n      parameters:\n        - $ref: '#/components/parameters/typeKey'\n        - name: staff_id\n          in: query\n          required: true\n          schema:\n            type: string\n      responses:\n        '200':\n          description: Type config deleted\n          content:\n            application/json:\n              schema:\n                type: object\n                properties:\n                  deleted:\n                    type: boolean\n                  type_key:\n                    type: string\n        '400':\n          description: Cannot delete built-in type\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n        '404':\n          $ref: '#/components/responses/NotFound'\n\n  # ============================================================\n  #  APPROVAL ENDPOINT BINDINGS\n  # ============================================================\n  /approvals/endpoint-bindings:\n    get:\n      operationId: listEndpointBindings\n      tags: [Approvals]\n      summary: List endpoint bindings\n      description: List all approval endpoint bindings with optional filters.\n      parameters:\n        - name: approval_type\n          in: query\n          schema:\n            type: string\n        - name: enabled_only\n          in: query\n          schema:\n            type: string\n            enum: ['true', 'false']\n      responses:\n        '200':\n          description: Binding list\n          content:\n            application/json:\n              schema:\n                type: object\n                properties:\n                  items:\n                    type: array\n                    items:\n                      $ref: '#/components/schemas/ApprovalEndpointBinding'\n    post:\n      operationId: createEndpointBinding\n      tags: [Approvals]\n      summary: Create endpoint binding\n      description: Bind an approval type to a route pattern and HTTP method.\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/CreateEndpointBindingRequest'\n      responses:\n        '201':\n          description: Binding created\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ApprovalEndpointBinding'\n        '400':\n          $ref: '#/components/responses/ValidationError'\n        '409':\n          description: Binding already exists for this route/method\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  /approvals/endpoint-bindings/lookup:\n    get:\n      operationId: lookupEndpointBinding\n      tags: [Approvals]\n      summary: Lookup endpoint binding\n      description: Check if a specific route/method has an active approval binding.\n      parameters:\n        - name: route\n          in: query\n          required: true\n          schema:\n            type: string\n        - name: method\n          in: query\n          schema:\n            type: string\n            default: POST\n            enum: [GET, POST, PUT, PATCH, DELETE]\n      responses:\n        '200':\n          description: Binding lookup result\n          content:\n            application/json:\n              schema:\n                type: object\n                properties:\n                  bound:\n                    type: boolean\n                  route:\n                    type: string\n                  method:\n                    type: string\n                  approval_type:\n                    type: string\n                  binding_id:\n                    type: string\n\n  /approvals/endpoint-bindings/{bindingId}:\n    get:\n      operationId: getEndpointBinding\n      tags: [Approvals]\n      summary: Get endpoint binding\n      description: Retrieve a specific endpoint binding by ID.\n      parameters:\n        - $ref: '#/components/parameters/bindingId'\n      responses:\n        '200':\n          description: Binding details\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ApprovalEndpointBinding'\n        '404':\n          $ref: '#/components/responses/NotFound'\n    patch:\n      operationId: updateEndpointBinding\n      tags: [Approvals]\n      summary: Update endpoint binding\n      description: Update an existing endpoint binding.\n      parameters:\n        - $ref: '#/components/parameters/bindingId'\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              type: object\n              required: [staff_id]\n              properties:\n                staff_id:\n                  type: string\n                route_pattern:\n                  type: string\n                http_method:\n                  type: string\n                  enum: [GET, POST, PUT, PATCH, DELETE]\n                approval_type:\n                  type: string\n                description:\n                  type: string\n                extract_payload:\n                  type: object\n                  additionalProperties: true\n                  nullable: true\n                enabled:\n                  type: boolean\n      responses:\n        '200':\n          description: Binding updated\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ApprovalEndpointBinding'\n        '400':\n          $ref: '#/components/responses/ValidationError'\n        '404':\n          $ref: '#/components/responses/NotFound'\n    delete:\n      operationId: deleteEndpointBinding\n      tags: [Approvals]\n      summary: Delete endpoint binding\n      description: Delete an endpoint binding.\n      parameters:\n        - $ref: '#/components/parameters/bindingId'\n        - name: staff_id\n          in: query\n          required: true\n          schema:\n            type: string\n      responses:\n        '200':\n          description: Binding deleted\n          content:\n            application/json:\n              schema:\n                type: object\n                properties:\n                  deleted:\n                    type: boolean\n                  id:\n                    type: string\n        '404':\n          $ref: '#/components/responses/NotFound'\n\n  # ============================================================\n  #  OPS — Staff-Only\n  # ============================================================\n  /ops/ledger/journal/{journalId}:\n    get:\n      operationId: getOpsJournal\n      tags: [Ops]\n      summary: Inspect ledger journal\n      description: Retrieve journal header and all lines. Staff authentication required (X-Staff-Id header).\n      security:\n        - StaffAuth: []\n      parameters:\n        - name: journalId\n          in: path\n          required: true\n          schema:\n            type: string\n        - $ref: '#/components/parameters/staffIdHeader'\n      responses:\n        '200':\n          description: Journal with lines\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/JournalResponse'\n        '401':\n          $ref: '#/components/responses/StaffRequired'\n        '404':\n          $ref: '#/components/responses/NotFound'\n\n  /ops/ledger/verify:\n    get:\n      operationId: verifyLedgerIntegrity\n      tags: [Ops, Reconciliation]\n      summary: Verify ledger hash chain integrity\n      description: Walk journals sequentially and verify hash chain continuity. Returns integrity report.\n      security:\n        - StaffAuth: []\n      parameters:\n        - name: from\n          in: query\n          schema:\n            type: string\n            format: date-time\n          description: Start timestamp (inclusive)\n        - name: to\n          in: query\n          schema:\n            type: string\n            format: date-time\n          description: End timestamp (inclusive)\n        - $ref: '#/components/parameters/staffIdHeader'\n      responses:\n        '200':\n          description: Integrity verification result\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/IntegrityVerifyResponse'\n        '401':\n          $ref: '#/components/responses/StaffRequired'\n\n  /ops/reconciliation/run:\n    post:\n      operationId: runReconciliation\n      tags: [Reconciliation]\n      summary: Run reconciliation\n      description: Trigger a reconciliation run. Compares ledger-derived balances to materialized balances. Emits alerts for mismatches.\n      security:\n        - StaffAuth: []\n      parameters:\n        - $ref: '#/components/parameters/staffIdHeader'\n      responses:\n        '200':\n          description: Reconciliation result\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ReconciliationRunResponse'\n        '401':\n          $ref: '#/components/responses/StaffRequired'\n\n  /ops/reconciliation/runs:\n    get:\n      operationId: listReconciliationRuns\n      tags: [Reconciliation]\n      summary: List reconciliation runs\n      description: Retrieve all reconciliation run records.\n      security:\n        - StaffAuth: []\n      parameters:\n        - $ref: '#/components/parameters/staffIdHeader'\n      responses:\n        '200':\n          description: List of runs\n          content:\n            application/json:\n              schema:\n                type: object\n                properties:\n                  runs:\n                    type: array\n                    items:\n                      $ref: '#/components/schemas/ReconciliationRun'\n                  count:\n                    type: integer\n        '401':\n          $ref: '#/components/responses/StaffRequired'\n\n  /ops/reconciliation/findings:\n    get:\n      operationId: listReconciliationFindings\n      tags: [Reconciliation]\n      summary: List reconciliation findings\n      description: Retrieve reconciliation findings with optional status filter.\n      security:\n        - StaffAuth: []\n      parameters:\n        - name: status\n          in: query\n          schema:\n            type: string\n            enum: [OPEN, ACKNOWLEDGED, RESOLVED]\n        - $ref: '#/components/parameters/staffIdHeader'\n      responses:\n        '200':\n          description: List of findings\n          content:\n            application/json:\n              schema:\n                type: object\n                properties:\n                  findings:\n                    type: array\n                    items:\n                      $ref: '#/components/schemas/ReconciliationFinding'\n                  count:\n                    type: integer\n        '401':\n          $ref: '#/components/responses/StaffRequired'\n\n  /ops/repair/idempotency/{journalId}:\n    post:\n      operationId: repairIdempotency\n      tags: [Ops]\n      summary: Repair idempotency record for journal\n      description: |\n        If a journal exists but its idempotency record is missing, safely reconstruct it.\n        Emits REPAIR_PERFORMED event and audit log entry. **Never modifies ledger entries.**\n      security:\n        - StaffAuth: []\n      parameters:\n        - name: journalId\n          in: path\n          required: true\n          schema:\n            type: string\n        - $ref: '#/components/parameters/staffIdHeader'\n      responses:\n        '200':\n          description: Repair result\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/RepairResponse'\n        '401':\n          $ref: '#/components/responses/StaffRequired'\n        '404':\n          $ref: '#/components/responses/NotFound'\n\n  /ops/repair/state/{journalId}:\n    post:\n      operationId: repairState\n      tags: [Ops]\n      summary: Repair stale idempotency state for journal\n      description: |\n        If a journal's idempotency record is stuck in IN_PROGRESS beyond timeout, mark it COMPLETED.\n        Emits STATE_REPAIRED event. **Never modifies ledger entries.**\n      security:\n        - StaffAuth: []\n      parameters:\n        - name: journalId\n          in: path\n          required: true\n          schema:\n            type: string\n        - $ref: '#/components/parameters/staffIdHeader'\n      responses:\n        '200':\n          description: Repair result\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/RepairResponse'\n        '401':\n          $ref: '#/components/responses/StaffRequired'\n        '404':\n          $ref: '#/components/responses/NotFound'\n\n  /ops/float/suspense/fund:\n    post:\n      operationId: requestSuspenseFunding\n      tags: [Ops]\n      summary: Request system suspense funding\n      description: |\n        Create a maker-checker approval request to fund the system suspense account for float allocations.\n        - Maker must be `SUPER_ADMIN` or `ADMIN`.\n        - Checker must be a `FINANCE` staff user.\n        - Ledger posting happens only after approval.\n      security:\n        - StaffAuth: []\n      parameters:\n        - $ref: '#/components/parameters/staffIdHeader'\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/SuspenseFundRequest'\n            example:\n              amount: '5000.00'\n              currency: BBD\n              reason: 'Opening treasury float for branch operations'\n              reference: 'BANK-SETTLEMENT-2026-02-21'\n              idempotency_key: 'suspense-fund-001'\n              correlation_id: '01HZ...'\n      responses:\n        '201':\n          description: Approval request created\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/SuspenseFundRequestResponse'\n        '400':\n          $ref: '#/components/responses/ValidationError'\n        '401':\n          $ref: '#/components/responses/StaffRequired'\n        '403':\n          description: Maker role not authorized\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n        '409':\n          description: No active finance checker available\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  # ============================================================\n  #  OVERDRAFT (Staff-Only, Maker-Checker)\n  # ============================================================\n  /ops/overdraft/request:\n    post:\n      operationId: requestOverdraft\n      tags: [Overdraft]\n      summary: Request overdraft facility\n      description: |\n        Create an overdraft facility request. Requires maker-checker approval before activation.\n        Creates both the facility (PENDING) and an approval request.\n      security:\n        - StaffAuth: []\n      parameters:\n        - $ref: '#/components/parameters/staffIdHeader'\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/OverdraftFacilityRequest'\n            example:\n              account_id: '01HZ...'\n              limit_amount: '5000.00'\n              currency: BBD\n              correlation_id: '01HZ...'\n      responses:\n        '201':\n          description: Overdraft request created\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/OverdraftRequestResponse'\n        '400':\n          $ref: '#/components/responses/ValidationError'\n        '401':\n          $ref: '#/components/responses/StaffRequired'\n\n  /ops/overdraft/{facilityId}/approve:\n    post:\n      operationId: approveOverdraft\n      tags: [Overdraft]\n      summary: Approve overdraft facility\n      description: |\n        Approve an overdraft facility. **Maker-checker enforced**: approver must differ from requester.\n      security:\n        - StaffAuth: []\n      parameters:\n        - name: facilityId\n          in: path\n          required: true\n          schema:\n            type: string\n        - $ref: '#/components/parameters/staffIdHeader'\n      requestBody:\n        content:\n          application/json:\n            schema:\n              type: object\n              properties:\n                correlation_id:\n                  type: string\n      responses:\n        '200':\n          description: Overdraft approved\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/OverdraftActionResponse'\n        '401':\n          $ref: '#/components/responses/StaffRequired'\n        '403':\n          description: Maker cannot approve own request\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n        '404':\n          $ref: '#/components/responses/NotFound'\n        '409':\n          description: Already decided\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  /ops/overdraft/{facilityId}/reject:\n    post:\n      operationId: rejectOverdraft\n      tags: [Overdraft]\n      summary: Reject overdraft facility\n      description: Reject an overdraft facility request.\n      security:\n        - StaffAuth: []\n      parameters:\n        - name: facilityId\n          in: path\n          required: true\n          schema:\n            type: string\n        - $ref: '#/components/parameters/staffIdHeader'\n      requestBody:\n        content:\n          application/json:\n            schema:\n              type: object\n              properties:\n                reason:\n                  type: string\n                correlation_id:\n                  type: string\n      responses:\n        '200':\n          description: Overdraft rejected\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/OverdraftActionResponse'\n        '401':\n          $ref: '#/components/responses/StaffRequired'\n        '404':\n          $ref: '#/components/responses/NotFound'\n        '409':\n          description: Already decided\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  /ops/overdraft:\n    get:\n      operationId: listOverdraftFacilities\n      tags: [Overdraft]\n      summary: List overdraft facilities\n      description: List overdraft facilities with optional filters. Returns 501 (stub).\n      security:\n        - StaffAuth: []\n      parameters:\n        - name: actorType\n          in: query\n          schema:\n            $ref: '#/components/schemas/OwnerType'\n        - name: actorId\n          in: query\n          schema:\n            type: string\n        - name: status\n          in: query\n          schema:\n            type: string\n            enum: [PENDING, ACTIVE, REJECTED]\n        - $ref: '#/components/parameters/staffIdHeader'\n      responses:\n        '200':\n          description: Overdraft list\n          content:\n            application/json:\n              schema:\n                type: object\n                properties:\n                  items:\n                    type: array\n                    items:\n                      $ref: '#/components/schemas/OverdraftFacility'\n                  count:\n                    type: integer\n        '401':\n          $ref: '#/components/responses/StaffRequired'\n        '501':\n          description: Not yet implemented\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/ErrorResponse'\n\n  # ============================================================\n  #  SERVICE ROOT\n  # ============================================================\n  /:\n    get:\n      operationId: getServiceInfo\n      tags: [Ops]\n      summary: Service info\n      description: Returns service name and version.\n      responses:\n        '200':\n          description: Service info\n          content:\n            application/json:\n              schema:\n                type: object\n                properties:\n                  service:\n                    type: string\n                    example: CariCash Nova API\n                  version:\n                    type: string\n                    example: 0.2.0\n\n  /docs:\n    get:\n      operationId: getSwaggerUI\n      tags: [Ops]\n      summary: Swagger UI\n      description: Serves interactive Swagger UI for API documentation.\n      responses:\n        '200':\n          description: HTML page with Swagger UI\n\n  /openapi.yaml:\n    get:\n      operationId: getOpenApiYaml\n      tags: [Ops]\n      summary: OpenAPI spec (YAML)\n      description: Returns the raw OpenAPI 3.1 specification in YAML format.\n      responses:\n        '200':\n          description: OpenAPI YAML spec\n          content:\n            text/yaml:\n              schema:\n                type: string\n\n  /openapi.json:\n    get:\n      operationId: getOpenApiJson\n      tags: [Ops]\n      summary: OpenAPI spec (JSON)\n      description: Returns the OpenAPI 3.1 specification in JSON format.\n      responses:\n        '200':\n          description: OpenAPI JSON spec\n          content:\n            application/json:\n              schema:\n                type: object\n\n# ==============================================================\n#  COMPONENTS\n# ==============================================================\ncomponents:\n  securitySchemes:\n    CustomerAuth:\n      type: http\n      scheme: bearer\n      description: Bearer token obtained from POST /auth/customer/login\n    AgentAuth:\n      type: http\n      scheme: bearer\n      description: Bearer token obtained from POST /auth/agent/login\n    MerchantAuth:\n      type: http\n      scheme: bearer\n      description: Bearer token obtained from POST /auth/merchant/login\n    StaffAuth:\n      type: http\n      scheme: bearer\n      description: Bearer token obtained from POST /auth/staff/login (OAuth stub)\n\n  parameters:\n    customerId:\n      name: customerId\n      in: path\n      required: true\n      schema:\n        type: string\n      description: Customer actor ID (ULID)\n    agentId:\n      name: agentId\n      in: path\n      required: true\n      schema:\n        type: string\n      description: Agent actor ID (ULID)\n    merchantId:\n      name: merchantId\n      in: path\n      required: true\n      schema:\n        type: string\n      description: Merchant actor ID (ULID)\n    approvalId:\n      name: approvalId\n      in: path\n      required: true\n      schema:\n        type: string\n      description: Approval request ID (ULID)\n    staffIdHeader:\n      name: X-Staff-Id\n      in: header\n      required: true\n      schema:\n        type: string\n      description: Staff actor ID for authentication (placeholder — production will use JWT)\n    cursor:\n      name: cursor\n      in: query\n      required: false\n      schema:\n        type: string\n      description: Opaque pagination cursor\n    pageSize:\n      name: pageSize\n      in: query\n      required: false\n      schema:\n        type: integer\n        default: 50\n        minimum: 1\n        maximum: 200\n      description: Number of items per page\n    policyId:\n      name: policyId\n      in: path\n      required: true\n      schema:\n        type: string\n      description: Approval policy ID (ULID)\n    typeKey:\n      name: typeKey\n      in: path\n      required: true\n      schema:\n        type: string\n      description: Approval type key (UPPER_SNAKE_CASE)\n    bindingId:\n      name: bindingId\n      in: path\n      required: true\n      schema:\n        type: string\n      description: Endpoint binding ID (ULID)\n\n  responses:\n    ValidationError:\n      description: Validation error\n      content:\n        application/json:\n          schema:\n            $ref: '#/components/schemas/ErrorResponse'\n          example:\n            error: 'Validation failed'\n            code: VALIDATION_ERROR\n            correlation_id: '01HZ...'\n    Unauthorized:\n      description: Authentication failed\n      content:\n        application/json:\n          schema:\n            $ref: '#/components/schemas/ErrorResponse'\n          example:\n            error: 'Invalid credentials'\n            correlation_id: '01HZ...'\n    NotFound:\n      description: Resource not found\n      content:\n        application/json:\n          schema:\n            $ref: '#/components/schemas/ErrorResponse'\n          example:\n            error: 'Not found'\n            code: NOT_FOUND\n            correlation_id: '01HZ...'\n    StaffRequired:\n      description: Staff authentication required\n      content:\n        application/json:\n          schema:\n            $ref: '#/components/schemas/ErrorResponse'\n          example:\n            error: 'Staff authentication required'\n            code: UNAUTHORIZED\n    RateLimited:\n      description: Rate limit exceeded\n      content:\n        application/json:\n          schema:\n            $ref: '#/components/schemas/ErrorResponse'\n          example:\n            error: 'Rate limit exceeded'\n            correlation_id: '01HZ...'\n\n  schemas:\n    # ---- Enums ----\n    OwnerType:\n      type: string\n      enum: [CUSTOMER, AGENT, MERCHANT, STAFF]\n    ActorType:\n      type: string\n      enum: [CUSTOMER, AGENT, MERCHANT, STAFF]\n    AgentTypeEnum:\n      type: string\n      enum: [STANDARD, AGGREGATOR]\n    TxnType:\n      type: string\n      enum: [DEPOSIT, WITHDRAWAL, P2P, PAYMENT, B2B, REVERSAL, MANUAL_ADJUSTMENT, OVERDRAFT_DRAW, FLOAT_TOP_UP, FLOAT_WITHDRAWAL]\n    RegistrationType:\n      type: string\n      enum: [SELF_REGISTRATION, AGENT_REGISTRATION, STAFF_REGISTRATION, BULK_IMPORT, API_INTEGRATION, MERCHANT_REFERRAL]\n    RegistrationChannel:\n      type: string\n      enum: [USSD, APP, WEB, API, PORTAL, IN_PERSON]\n    PreferredNameSource:\n      type: string\n      enum: [FIRST_NAME, MIDDLE_NAME, LAST_NAME, FULL_NAME, CUSTOM]\n    TxnState:\n      type: string\n      enum: [INITIATED, VALIDATED, AUTHORIZED, POSTED, COMPLETED, FAILED, REVERSED, PENDING_APPROVAL]\n    CurrencyCode:\n      type: string\n      enum: [BBD, USD]\n      description: Supported currency codes. BBD is the base currency.\n    ApprovalStatus:\n      type: string\n      enum: [PENDING, APPROVED, REJECTED, EXPIRED]\n    ApprovalType:\n      type: string\n      description: |\n        Approval type key. Built-in types are listed below, but custom types can be\n        configured at runtime via the /approvals/types/config API.\n      enum: [REVERSAL_REQUESTED, MANUAL_ADJUSTMENT_REQUESTED, FEE_MATRIX_CHANGE_REQUESTED, COMMISSION_MATRIX_CHANGE_REQUESTED, OVERDRAFT_FACILITY_REQUESTED, MERCHANT_WITHDRAWAL_REQUESTED]\n    KycStatus:\n      type: string\n      enum: [NOT_STARTED, PENDING, APPROVED, REJECTED]\n    ActorState:\n      type: string\n      enum: [PENDING, ACTIVE, SUSPENDED, CLOSED]\n    StaffRole:\n      type: string\n      enum: [SUPER_ADMIN, ADMIN, OPERATIONS, COMPLIANCE, FINANCE, SUPPORT]\n    AccountType:\n      type: string\n      enum: [WALLET, FEE_REVENUE, TAX_PAYABLE, COMMISSIONS_PAYABLE, OVERDRAFT_FACILITY, SUSPENSE, CASH_FLOAT]\n    ErrorCodeEnum:\n      type: string\n      enum:\n        - UNAUTHORIZED\n        - FORBIDDEN\n        - VALIDATION_ERROR\n        - INSUFFICIENT_FUNDS\n        - CROSS_CURRENCY_NOT_ALLOWED\n        - LIMIT_EXCEEDED\n        - KYC_REQUIRED\n        - BLOCKLISTED\n        - DUPLICATE_IDEMPOTENCY_CONFLICT\n        - IDEMPOTENCY_IN_PROGRESS\n        - MAKER_CHECKER_REQUIRED\n        - NOT_FOUND\n        - CONFLICT\n        - INTERNAL_ERROR\n        - UNBALANCED_JOURNAL\n        - JOURNAL_NOT_FOUND\n        - ACCOUNT_NOT_FOUND\n        - MAKER_CHECKER_VIOLATION\n        - APPROVAL_NOT_FOUND\n        - APPROVAL_ALREADY_DECIDED\n        - INVALID_CREDENTIALS\n        - ACCOUNT_LOCKED\n        - RATE_LIMIT_EXCEEDED\n        - SESSION_EXPIRED\n        - ACTOR_NOT_FOUND\n        - ACTOR_SUSPENDED\n        - DUPLICATE_IDENTIFIER\n        - MISSING_REQUIRED_FIELD\n        - RECONCILIATION_MISMATCH\n        - INTEGRITY_VIOLATION\n        - REPAIR_FAILED\n\n    # ---- Error response ----\n    ErrorResponse:\n      type: object\n      required: [error]\n      properties:\n        error:\n          type: string\n          description: Human-readable error message\n        code:\n          $ref: '#/components/schemas/ErrorCodeEnum'\n        name:\n          type: string\n          description: Error class name\n        correlation_id:\n          type: string\n        details:\n          type: object\n          additionalProperties: true\n        retryable:\n          type: boolean\n          default: false\n\n    # ---- Auth requests ----\n    CustomerLoginRequest:\n      type: object\n      required: [msisdn, pin]\n      properties:\n        msisdn:\n          type: string\n          description: Customer phone number\n        pin:\n          type: string\n          description: Customer PIN\n\n    AgentLoginRequest:\n      type: object\n      required: [agent_code, pin]\n      properties:\n        agent_code:\n          type: string\n          description: Agent identifier code\n        msisdn:\n          type: string\n          description: Optional agent user phone number for agent-user login\n        pin:\n          type: string\n          description: Agent PIN\n\n    MerchantLoginRequest:\n      type: object\n      required: [msisdn, pin]\n      properties:\n        msisdn:\n          type: string\n          description: Merchant login phone number\n        store_code:\n          type: string\n          description: Optional store identifier for legacy store-scoped login\n        pin:\n          type: string\n          description: Merchant PIN\n\n    StaffLoginRequest:\n      type: object\n      required: [staff_code, pin]\n      properties:\n        staff_code:\n          type: string\n          description: Staff identifier code\n        pin:\n          type: string\n          description: Staff PIN\n\n    LoginResponse:\n      type: object\n      properties:\n        token:\n          type: string\n          description: Bearer token for subsequent requests\n        actor_id:\n          type: string\n        actor_type:\n          $ref: '#/components/schemas/ActorType'\n        session_id:\n          type: string\n        correlation_id:\n          type: string\n\n    # ---- Actor objects ----\n    Actor:\n      type: object\n      properties:\n        id:\n          type: string\n        type:\n          $ref: '#/components/schemas/ActorType'\n        state:\n          $ref: '#/components/schemas/ActorState'\n        msisdn:\n          type: string\n        agent_code:\n          type: string\n        agent_type:\n          $ref: '#/components/schemas/AgentTypeEnum'\n        store_code:\n          type: string\n        staff_code:\n          type: string\n        name:\n          type: string\n        first_name:\n          type: string\n        middle_name:\n          type: string\n        last_name:\n          type: string\n        display_name:\n          type: string\n        email:\n          type: string\n          format: email\n        kyc_state:\n          $ref: '#/components/schemas/KycStatus'\n        created_at:\n          type: string\n          format: date-time\n        updated_at:\n          type: string\n          format: date-time\n\n    ActorResponse:\n      type: object\n      properties:\n        actor:\n          $ref: '#/components/schemas/Actor'\n        correlation_id:\n          type: string\n\n    # ---- Customer ----\n    CreateCustomerRequest:\n      type: object\n      required: [msisdn, name, pin]\n      properties:\n        msisdn:\n          type: string\n        name:\n          type: string\n        first_name:\n          type: string\n        middle_name:\n          type: string\n        last_name:\n          type: string\n        preferred_name:\n          $ref: '#/components/schemas/PreferredNameSource'\n        display_name:\n          type: string\n        email:\n          type: string\n          format: email\n        pin:\n          type: string\n        registration_type:\n          $ref: '#/components/schemas/RegistrationType'\n        channel:\n          $ref: '#/components/schemas/RegistrationChannel'\n        registered_by_actor_id:\n          type: string\n        referral_code:\n          type: string\n        campaign_id:\n          type: string\n        terms_accepted:\n          type: boolean\n        privacy_accepted:\n          type: boolean\n        marketing_opt_in:\n          type: boolean\n        correlation_id:\n          type: string\n        idempotency_key:\n          type: string\n\n    CreateCustomerResponse:\n      type: object\n      properties:\n        actor:\n          $ref: '#/components/schemas/Actor'\n        wallet_id:\n          type: string\n        registration_id:\n          type: string\n        registration_type:\n          $ref: '#/components/schemas/RegistrationType'\n        correlation_id:\n          type: string\n\n    # ---- Staff ----\n    CreateStaffRequest:\n      type: object\n      required: [staff_code, name, staff_role, pin]\n      properties:\n        staff_code:\n          type: string\n        name:\n          type: string\n        email:\n          type: string\n          format: email\n        msisdn:\n          type: string\n        staff_role:\n          $ref: '#/components/schemas/StaffRole'\n        pin:\n          type: string\n        correlation_id:\n          type: string\n\n    UpdateStaffRequest:\n      type: object\n      properties:\n        name:\n          type: string\n        email:\n          type: string\n          format: email\n        staff_role:\n          $ref: '#/components/schemas/StaffRole'\n        state:\n          $ref: '#/components/schemas/ActorState'\n        correlation_id:\n          type: string\n\n    StaffActionRequest:\n      type: object\n      required: [action]\n      properties:\n        action:\n          type: string\n          enum: [ACTIVATE, SUSPEND, CLOSE, UNLOCK]\n        reason:\n          type: string\n        correlation_id:\n          type: string\n\n    StaffActionResponse:\n      type: object\n      properties:\n        success:\n          type: boolean\n        action:\n          type: string\n        actor:\n          $ref: '#/components/schemas/Actor'\n        state:\n          $ref: '#/components/schemas/ActorState'\n        unlocked:\n          type: boolean\n        actor_id:\n          type: string\n        correlation_id:\n          type: string\n\n    StaffListResponse:\n      type: object\n      properties:\n        items:\n          type: array\n          items:\n            $ref: '#/components/schemas/Actor'\n        count:\n          type: integer\n\n    # ---- Agent ----\n    CreateAgentRequest:\n      type: object\n      required: [name, msisdn, pin, agent_type]\n      properties:\n        agent_code:\n          type: string\n          minLength: 6\n          maxLength: 6\n          pattern: '^\\\\d{6}$'\n          description: Optional pre-selected code from /codes/generate\n        name:\n          type: string\n        owner_name:\n          type: string\n          description: Optional owner display name for the created agent_owner user\n        msisdn:\n          type: string\n        pin:\n          type: string\n        agent_type:\n          $ref: '#/components/schemas/AgentTypeEnum'\n        parent_aggregator_id:\n          type: string\n          description: Optional parent AGGREGATOR actor id for child-agent registration\n        correlation_id:\n          type: string\n\n    CreateAgentResponse:\n      type: object\n      properties:\n        actor:\n          $ref: '#/components/schemas/Actor'\n        agent_code:\n          type: string\n        owner_user_id:\n          type: string\n        owner_user_role:\n          type: string\n          enum: [agent_owner]\n        parent_aggregator_id:\n          type: string\n        wallet_id:\n          type: string\n        cash_float_id:\n          type: string\n        correlation_id:\n          type: string\n\n    # ---- Merchant ----\n    CreateMerchantRequest:\n      type: object\n      required: [name, msisdn, owner_name, pin]\n      properties:\n        name:\n          type: string\n        owner_name:\n          type: string\n        owner_first_name:\n          type: string\n        owner_last_name:\n          type: string\n        business_registration_no:\n          type: string\n        tax_id:\n          type: string\n        msisdn:\n          type: string\n        email:\n          type: string\n          format: email\n        pin:\n          type: string\n        pin_confirm:\n          type: string\n        correlation_id:\n          type: string\n\n    CreateMerchantResponse:\n      type: object\n      properties:\n        actor:\n          $ref: '#/components/schemas/Actor'\n        wallet_id:\n          type: string\n        owner_user_id:\n          type: string\n        correlation_id:\n          type: string\n\n    CreateStoreRequest:\n      type: object\n      required: [name, msisdn, owner_name, pin]\n      properties:\n        store_code:\n          type: string\n          minLength: 6\n          maxLength: 6\n          pattern: '^\\\\d{6}$'\n          description: Optional pre-selected code from /codes/generate\n        name:\n          type: string\n        msisdn:\n          type: string\n        owner_name:\n          type: string\n        email:\n          type: string\n          format: email\n        pin:\n          type: string\n        pin_confirm:\n          type: string\n        correlation_id:\n          type: string\n\n    CreateStoreResponse:\n      type: object\n      properties:\n        merchant_id:\n          type: string\n        store:\n          $ref: '#/components/schemas/Actor'\n        store_code:\n          type: string\n        wallet_id:\n          type: string\n        owner_user_id:\n          type: string\n        correlation_id:\n          type: string\n\n    GenerateCodesRequest:\n      type: object\n      required: [code_type]\n      properties:\n        code_type:\n          type: string\n          enum: [AGENT, STORE]\n        count:\n          type: integer\n          minimum: 1\n          maximum: 20\n          default: 5\n        merchant_id:\n          type: string\n          description: Required when code_type = STORE\n        ttl_minutes:\n          type: integer\n          minimum: 5\n          maximum: 240\n          default: 30\n        correlation_id:\n          type: string\n\n    GenerateCodesResponse:\n      type: object\n      properties:\n        code_type:\n          type: string\n          enum: [AGENT, STORE]\n        codes:\n          type: array\n          items:\n            type: string\n            minLength: 6\n            maxLength: 6\n            pattern: '^\\\\d{6}$'\n        count:\n          type: integer\n        reserved_for_merchant_id:\n          type: string\n        expires_at:\n          type: string\n          format: date-time\n        correlation_id:\n          type: string\n\n    # ---- KYC ----\n    KycInitiateRequest:\n      type: object\n      required: [document_type, document_number]\n      properties:\n        document_type:\n          type: string\n          description: Document type (e.g., NATIONAL_ID, PASSPORT)\n        document_number:\n          type: string\n        correlation_id:\n          type: string\n\n    KycInitiateResponse:\n      type: object\n      properties:\n        actor_id:\n          type: string\n        kyc_state:\n          $ref: '#/components/schemas/KycStatus'\n        correlation_id:\n          type: string\n\n    KycProfileResponse:\n      type: object\n      properties:\n        actor_id:\n          type: string\n        kyc_state:\n          $ref: '#/components/schemas/KycStatus'\n        document_type:\n          type: string\n        document_number:\n          type: string\n\n    # ---- Wallet ----\n    BalanceResponse:\n      type: object\n      properties:\n        owner_type:\n          $ref: '#/components/schemas/OwnerType'\n        owner_id:\n          type: string\n        currency:\n          $ref: '#/components/schemas/CurrencyCode'\n        account_id:\n          type: string\n        balance:\n          type: string\n          description: Decimal string (e.g., \"1000.00\")\n        actual_balance:\n          type: string\n          description: Materialized actual balance for the account\n        available_balance:\n          type: string\n          description: Spendable or withdrawable balance\n        hold_amount:\n          type: string\n          description: Amount currently on hold\n        pending_credits:\n          type: string\n          description: Credits awaiting release\n        correlation_id:\n          type: string\n\n    AccountBalanceEntry:\n      type: object\n      properties:\n        account_id:\n          type: string\n        owner_type:\n          $ref: '#/components/schemas/OwnerType'\n        owner_id:\n          type: string\n        account_type:\n          $ref: '#/components/schemas/AccountType'\n        currency:\n          $ref: '#/components/schemas/CurrencyCode'\n        actual_balance:\n          type: string\n        available_balance:\n          type: string\n        hold_amount:\n          type: string\n        pending_credits:\n          type: string\n        updated_at:\n          type: string\n          format: date-time\n\n    AllBalancesResponse:\n      type: object\n      properties:\n        owner_type:\n          $ref: '#/components/schemas/OwnerType'\n        owner_id:\n          type: string\n        currency:\n          $ref: '#/components/schemas/CurrencyCode'\n        accounts:\n          type: array\n          items:\n            $ref: '#/components/schemas/AccountBalanceEntry'\n        correlation_id:\n          type: string\n\n    FloatTopUpRequest:\n      type: object\n      required: [agent_code, amount, staff_id, idempotency_key]\n      properties:\n        agent_code:\n          type: string\n        amount:\n          type: string\n        currency:\n          $ref: '#/components/schemas/CurrencyCode'\n        staff_id:\n          type: string\n        reason:\n          type: string\n        reference:\n          type: string\n        idempotency_key:\n          type: string\n        correlation_id:\n          type: string\n\n    FloatWithdrawalRequest:\n      allOf:\n        - $ref: '#/components/schemas/FloatTopUpRequest'\n\n    SuspenseFundRequest:\n      type: object\n      required: [amount, reason, idempotency_key]\n      properties:\n        amount:\n          type: string\n        currency:\n          $ref: '#/components/schemas/CurrencyCode'\n          default: BBD\n        reason:\n          type: string\n        reference:\n          type: string\n        idempotency_key:\n          type: string\n        correlation_id:\n          type: string\n\n    SuspenseFundRequestResponse:\n      type: object\n      properties:\n        request_id:\n          type: string\n        type:\n          $ref: '#/components/schemas/ApprovalType'\n        state:\n          $ref: '#/components/schemas/ApprovalStatus'\n        approval_target_role:\n          type: string\n          enum: [FINANCE]\n        finance_reviewers:\n          type: array\n          items:\n            type: object\n            properties:\n              id:\n                type: string\n              name:\n                type: string\n              staff_code:\n                type: string\n              staff_role:\n                type: string\n        details:\n          type: object\n          additionalProperties: true\n        correlation_id:\n          type: string\n\n    FloatOperation:\n      type: object\n      properties:\n        id:\n          type: string\n        agent_actor_id:\n          type: string\n        agent_account_id:\n          type: string\n        staff_actor_id:\n          type: string\n        operation_type:\n          type: string\n          enum: [TOP_UP, WITHDRAWAL, ADJUSTMENT, CORRECTION]\n        amount:\n          type: string\n        currency:\n          $ref: '#/components/schemas/CurrencyCode'\n        journal_id:\n          type: string\n        balance_before:\n          type: string\n        balance_after:\n          type: string\n        available_before:\n          type: string\n        available_after:\n          type: string\n        requires_approval:\n          type: boolean\n        reason:\n          type: string\n        reference:\n          type: string\n        idempotency_key:\n          type: string\n        correlation_id:\n          type: string\n        created_at:\n          type: string\n          format: date-time\n\n    FloatOperationResponse:\n      type: object\n      properties:\n        operation_id:\n          type: string\n        journal_id:\n          type: string\n        agent_id:\n          type: string\n        agent_code:\n          type: string\n        amount:\n          type: string\n        currency:\n          $ref: '#/components/schemas/CurrencyCode'\n        balance_before:\n          type: string\n        balance_after:\n          type: string\n        available_before:\n          type: string\n        available_after:\n          type: string\n        correlation_id:\n          type: string\n\n    FloatBalanceResponse:\n      type: object\n      properties:\n        agent_id:\n          type: string\n        agent_code:\n          type: string\n        currency:\n          $ref: '#/components/schemas/CurrencyCode'\n        account_id:\n          type: string\n        actual_balance:\n          type: string\n        available_balance:\n          type: string\n        hold_amount:\n          type: string\n        pending_credits:\n          type: string\n        correlation_id:\n          type: string\n\n    FloatHistoryResponse:\n      type: object\n      properties:\n        agent_id:\n          type: string\n        agent_code:\n          type: string\n        operations:\n          type: array\n          items:\n            $ref: '#/components/schemas/FloatOperation'\n        count:\n          type: integer\n        correlation_id:\n          type: string\n\n    StatementResponse:\n      type: object\n      properties:\n        items:\n          type: array\n          items:\n            $ref: '#/components/schemas/StatementEntry'\n        nextCursor:\n          type: string\n          nullable: true\n\n    StatementEntry:\n      type: object\n      properties:\n        journal_id:\n          type: string\n        txn_type:\n          $ref: '#/components/schemas/TxnType'\n        entry_type:\n          type: string\n          enum: [DR, CR]\n        amount:\n          type: string\n        description:\n          type: string\n        created_at:\n          type: string\n          format: date-time\n\n    AgentTransactionSummaryResponse:\n      type: object\n      properties:\n        agent_id:\n          type: string\n        cash_float_account_id:\n          type: string\n        currency:\n          $ref: '#/components/schemas/CurrencyCode'\n        today_date:\n          type: string\n          description: Date key in YYYY-MM-DD format\n        today_deposits:\n          type: string\n          description: Sum of today's deposits for this agent/currency\n        total_transacted:\n          type: string\n          description: Lifetime total of deposits and withdrawals for this agent/currency\n        today_cash:\n          type: string\n          description: Sum of today's withdrawals (cash-out) for backward compatibility\n        today_withdrawals:\n          type: string\n          description: Sum of today's withdrawals (cash-out)\n        today_txn_count:\n          type: integer\n          description: Count of today's deposit and withdrawal journals\n        cash_float_balance:\n          type: string\n          description: Current actual cash-float balance\n        cash_float_available_balance:\n          type: string\n          description: Current available cash-float balance\n        correlation_id:\n          type: string\n\n    # ---- Transaction requests ----\n    DepositRequest:\n      type: object\n      required: [agent_id, customer_msisdn, amount, currency, idempotency_key]\n      properties:\n        agent_id:\n          type: string\n        customer_msisdn:\n          type: string\n        amount:\n          type: string\n          description: Decimal amount (e.g., \"500.00\")\n        currency:\n          $ref: '#/components/schemas/CurrencyCode'\n        idempotency_key:\n          type: string\n          description: Unique key for idempotent retry\n        correlation_id:\n          type: string\n\n    WithdrawalRequest:\n      type: object\n      required: [agent_id, customer_msisdn, amount, currency, idempotency_key]\n      properties:\n        agent_id:\n          type: string\n        customer_msisdn:\n          type: string\n        amount:\n          type: string\n        currency:\n          $ref: '#/components/schemas/CurrencyCode'\n        idempotency_key:\n          type: string\n        correlation_id:\n          type: string\n\n    P2PRequest:\n      type: object\n      required: [sender_msisdn, receiver_msisdn, amount, currency, idempotency_key]\n      properties:\n        sender_msisdn:\n          type: string\n        receiver_msisdn:\n          type: string\n        amount:\n          type: string\n        currency:\n          $ref: '#/components/schemas/CurrencyCode'\n        idempotency_key:\n          type: string\n        correlation_id:\n          type: string\n\n    PaymentRequest:\n      type: object\n      required: [customer_msisdn, store_code, amount, currency, idempotency_key]\n      properties:\n        customer_msisdn:\n          type: string\n        store_code:\n          type: string\n        amount:\n          type: string\n        currency:\n          $ref: '#/components/schemas/CurrencyCode'\n        idempotency_key:\n          type: string\n        correlation_id:\n          type: string\n\n    B2BRequest:\n      type: object\n      required: [sender_store_code, receiver_store_code, amount, currency, idempotency_key]\n      properties:\n        sender_store_code:\n          type: string\n        receiver_store_code:\n          type: string\n        amount:\n          type: string\n        currency:\n          $ref: '#/components/schemas/CurrencyCode'\n        idempotency_key:\n          type: string\n        correlation_id:\n          type: string\n\n    ReversalRequest:\n      type: object\n      required: [original_journal_id, reason, staff_id, idempotency_key]\n      properties:\n        original_journal_id:\n          type: string\n        reason:\n          type: string\n        staff_id:\n          type: string\n        idempotency_key:\n          type: string\n        correlation_id:\n          type: string\n\n    # ---- Transaction receipt ----\n    TransactionReceipt:\n      type: object\n      properties:\n        journal_id:\n          type: string\n        state:\n          $ref: '#/components/schemas/TxnState'\n        txn_type:\n          $ref: '#/components/schemas/TxnType'\n        currency:\n          $ref: '#/components/schemas/CurrencyCode'\n        entries:\n          type: array\n          items:\n            $ref: '#/components/schemas/LedgerLineEntry'\n        created_at:\n          type: string\n          format: date-time\n        correlation_id:\n          type: string\n\n    LedgerLineEntry:\n      type: object\n      properties:\n        account_id:\n          type: string\n        entry_type:\n          type: string\n          enum: [DR, CR]\n        amount:\n          type: string\n        description:\n          type: string\n\n    ReversalRequestResponse:\n      type: object\n      properties:\n        request_id:\n          type: string\n        state:\n          $ref: '#/components/schemas/ApprovalStatus'\n        correlation_id:\n          type: string\n\n    # ---- Journal ----\n    JournalResponse:\n      type: object\n      properties:\n        journal:\n          type: object\n          properties:\n            id:\n              type: string\n            txn_type:\n              $ref: '#/components/schemas/TxnType'\n            currency:\n              $ref: '#/components/schemas/CurrencyCode'\n            correlation_id:\n              type: string\n            idempotency_key:\n              type: string\n            state:\n              $ref: '#/components/schemas/TxnState'\n            description:\n              type: string\n            created_at:\n              type: string\n              format: date-time\n            prev_hash:\n              type: string\n            hash:\n              type: string\n        lines:\n          type: array\n          items:\n            type: object\n            properties:\n              id:\n                type: string\n              journal_id:\n                type: string\n              account_id:\n                type: string\n              entry_type:\n                type: string\n                enum: [DR, CR]\n              amount:\n                type: string\n              description:\n                type: string\n              created_at:\n                type: string\n                format: date-time\n\n    # ---- Approvals ----\n    ApprovalActionRequest:\n      type: object\n      required: [staff_id]\n      properties:\n        staff_id:\n          type: string\n        correlation_id:\n          type: string\n\n    ApprovalRejectRequest:\n      type: object\n      required: [staff_id]\n      properties:\n        staff_id:\n          type: string\n        reason:\n          type: string\n        correlation_id:\n          type: string\n\n    ApprovalActionResponse:\n      type: object\n      properties:\n        request_id:\n          type: string\n        state:\n          $ref: '#/components/schemas/ApprovalStatus'\n        reversal:\n          $ref: '#/components/schemas/TransactionReceipt'\n        manual_adjustment:\n          $ref: '#/components/schemas/TransactionReceipt'\n        correlation_id:\n          type: string\n\n    ApprovalResponse:\n      type: object\n      properties:\n        id:\n          type: string\n        type:\n          $ref: '#/components/schemas/ApprovalType'\n        state:\n          $ref: '#/components/schemas/ApprovalStatus'\n        maker_staff_id:\n          type: string\n        checker_staff_id:\n          type: string\n        payload_json:\n          type: string\n        payload:\n          type: object\n          nullable: true\n          additionalProperties: true\n        created_at:\n          type: string\n          format: date-time\n        decided_at:\n          type: string\n          format: date-time\n\n    # ---- Approval Policies & Dynamic Types ----\n    ApprovalTypeInfo:\n      type: object\n      properties:\n        type:\n          type: string\n        label:\n          type: string\n        allowed_checker_roles:\n          type: array\n          items:\n            type: string\n        has_approve_handler:\n          type: boolean\n        has_reject_handler:\n          type: boolean\n        source:\n          type: string\n          enum: [code, config]\n\n    ApprovalPolicyFull:\n      type: object\n      properties:\n        id:\n          type: string\n        name:\n          type: string\n        description:\n          type: string\n        approval_type:\n          type: string\n        state:\n          type: string\n          enum: [DRAFT, ACTIVE, INACTIVE, ARCHIVED]\n        priority:\n          type: integer\n        created_by:\n          type: string\n        created_at:\n          type: string\n          format: date-time\n        updated_at:\n          type: string\n          format: date-time\n        conditions:\n          type: array\n          items:\n            $ref: '#/components/schemas/PolicyCondition'\n        stages:\n          type: array\n          items:\n            $ref: '#/components/schemas/PolicyStage'\n        bindings:\n          type: array\n          items:\n            $ref: '#/components/schemas/PolicyBinding'\n\n    PolicyCondition:\n      type: object\n      properties:\n        id:\n          type: string\n        field_path:\n          type: string\n        operator:\n          type: string\n          enum: [eq, neq, gt, gte, lt, lte, in, not_in, contains, regex, between, exists]\n        value_json:\n          type: string\n\n    PolicyStage:\n      type: object\n      properties:\n        id:\n          type: string\n        stage_no:\n          type: integer\n        min_approvals:\n          type: integer\n        roles_json:\n          type: string\n        actor_ids_json:\n          type: string\n        exclude_maker:\n          type: integer\n        exclude_previous_approvers:\n          type: integer\n        timeout_minutes:\n          type: integer\n        escalation_roles_json:\n          type: string\n\n    PolicyBinding:\n      type: object\n      properties:\n        id:\n          type: string\n        binding_type:\n          type: string\n          enum: [actor, actor_type, role, hierarchy, business_unit, currency, all]\n        binding_value_json:\n          type: string\n\n    PolicyConditionInput:\n      type: object\n      required: [field_path, operator, value]\n      properties:\n        field_path:\n          type: string\n        operator:\n          type: string\n          enum: [eq, neq, gt, gte, lt, lte, in, not_in, contains, regex, between, exists]\n        value:\n          description: Condition value (any JSON type)\n\n    PolicyStageInput:\n      type: object\n      required: [stage_no, min_approvals]\n      properties:\n        stage_no:\n          type: integer\n        min_approvals:\n          type: integer\n        roles:\n          type: array\n          items:\n            type: string\n        actor_ids:\n          type: array\n          items:\n            type: string\n        exclude_maker:\n          type: boolean\n          default: true\n        exclude_previous_approvers:\n          type: boolean\n          default: true\n        timeout_minutes:\n          type: integer\n        escalation_roles:\n          type: array\n          items:\n            type: string\n\n    PolicyBindingInput:\n      type: object\n      required: [binding_type, binding_value]\n      properties:\n        binding_type:\n          type: string\n          enum: [actor, actor_type, role, hierarchy, business_unit, currency, all]\n        binding_value:\n          description: Binding value (any JSON type)\n\n    CreateApprovalPolicyRequest:\n      type: object\n      required: [staff_id, name, approval_type]\n      properties:\n        staff_id:\n          type: string\n        name:\n          type: string\n        description:\n          type: string\n        approval_type:\n          type: string\n        priority:\n          type: integer\n          default: 100\n        conditions:\n          type: array\n          items:\n            $ref: '#/components/schemas/PolicyConditionInput'\n        stages:\n          type: array\n          items:\n            $ref: '#/components/schemas/PolicyStageInput'\n        bindings:\n          type: array\n          items:\n            $ref: '#/components/schemas/PolicyBindingInput'\n\n    PolicyEvaluationResult:\n      type: object\n      properties:\n        matched:\n          type: boolean\n        policy_id:\n          type: string\n        policy_name:\n          type: string\n        total_stages:\n          type: integer\n        stages:\n          type: array\n          items:\n            type: object\n            properties:\n              stage_no:\n                type: integer\n              min_approvals:\n                type: integer\n              allowed_roles:\n                type: array\n                items:\n                  type: string\n              allowed_actors:\n                type: array\n                items:\n                  type: string\n              timeout_minutes:\n                type: integer\n        reasons:\n          type: array\n          items:\n            type: string\n        all_evaluated:\n          type: array\n          items:\n            type: object\n            properties:\n              policy_id:\n                type: string\n              policy_name:\n                type: string\n              matched:\n                type: boolean\n              reasons:\n                type: array\n                items:\n                  type: string\n\n    ApprovalDelegation:\n      type: object\n      properties:\n        id:\n          type: string\n        delegator_id:\n          type: string\n        delegate_id:\n          type: string\n        approval_type:\n          type: string\n          nullable: true\n        valid_from:\n          type: string\n          format: date-time\n        valid_to:\n          type: string\n          format: date-time\n        reason:\n          type: string\n        state:\n          type: string\n          enum: [ACTIVE, REVOKED, EXPIRED]\n        created_by:\n          type: string\n        created_at:\n          type: string\n          format: date-time\n\n    CreateDelegationRequest:\n      type: object\n      required: [staff_id, delegator_id, delegate_id, valid_from, valid_to]\n      properties:\n        staff_id:\n          type: string\n        delegator_id:\n          type: string\n        delegate_id:\n          type: string\n        approval_type:\n          type: string\n          description: Optional — restrict delegation to a specific approval type\n        valid_from:\n          type: string\n          format: date-time\n        valid_to:\n          type: string\n          format: date-time\n        reason:\n          type: string\n\n    ApprovalTypeConfig:\n      type: object\n      properties:\n        type_key:\n          type: string\n        label:\n          type: string\n        description:\n          type: string\n        default_checker_roles:\n          type: array\n          items:\n            type: string\n          nullable: true\n        require_reason:\n          type: boolean\n        has_code_handler:\n          type: boolean\n        auto_policy_id:\n          type: string\n          nullable: true\n        enabled:\n          type: boolean\n        created_by:\n          type: string\n        created_at:\n          type: string\n          format: date-time\n        updated_at:\n          type: string\n          format: date-time\n\n    CreateTypeConfigRequest:\n      type: object\n      required: [staff_id, type_key, label]\n      properties:\n        staff_id:\n          type: string\n        type_key:\n          type: string\n          description: Unique type key in UPPER_SNAKE_CASE (3-64 chars)\n          pattern: '^[A-Z][A-Z0-9_]{2,63}$'\n        label:\n          type: string\n        description:\n          type: string\n        default_checker_roles:\n          type: array\n          items:\n            type: string\n        require_reason:\n          type: boolean\n        auto_policy_id:\n          type: string\n\n    ApprovalEndpointBinding:\n      type: object\n      properties:\n        id:\n          type: string\n        route_pattern:\n          type: string\n        http_method:\n          type: string\n          enum: [GET, POST, PUT, PATCH, DELETE]\n        approval_type:\n          type: string\n        description:\n          type: string\n        extract_payload:\n          type: object\n          additionalProperties: true\n          nullable: true\n        enabled:\n          type: boolean\n        created_by:\n          type: string\n        created_at:\n          type: string\n          format: date-time\n        updated_at:\n          type: string\n          format: date-time\n\n    CreateEndpointBindingRequest:\n      type: object\n      required: [staff_id, route_pattern, approval_type]\n      properties:\n        staff_id:\n          type: string\n        route_pattern:\n          type: string\n        http_method:\n          type: string\n          default: POST\n          enum: [GET, POST, PUT, PATCH, DELETE]\n        approval_type:\n          type: string\n        description:\n          type: string\n        extract_payload:\n          type: object\n          additionalProperties: true\n\n    # ---- Reconciliation ----\n    ReconciliationRun:\n      type: object\n      properties:\n        id:\n          type: string\n        started_at:\n          type: string\n          format: date-time\n        finished_at:\n          type: string\n          format: date-time\n        status:\n          type: string\n          enum: [RUNNING, COMPLETED, FAILED]\n        summary_json:\n          type: string\n\n    ReconciliationFinding:\n      type: object\n      properties:\n        id:\n          type: string\n        run_id:\n          type: string\n        account_id:\n          type: string\n        currency:\n          type: string\n        expected_balance:\n          type: string\n        actual_balance:\n          type: string\n        delta:\n          type: string\n        severity:\n          type: string\n          enum: [INFO, WARNING, CRITICAL, LOW, MEDIUM, HIGH]\n        status:\n          type: string\n          enum: [OPEN, ACKNOWLEDGED, RESOLVED]\n        created_at:\n          type: string\n          format: date-time\n\n    ReconciliationRunResponse:\n      type: object\n      properties:\n        run_id:\n          type: string\n        status:\n          type: string\n        findings_count:\n          type: integer\n        mismatches:\n          type: integer\n\n    # ---- Integrity ----\n    IntegrityVerifyResponse:\n      type: object\n      properties:\n        valid:\n          type: boolean\n        journals_verified:\n          type: integer\n        first_failure:\n          type: object\n          nullable: true\n          properties:\n            journal_id:\n              type: string\n            expected_hash:\n              type: string\n            actual_hash:\n              type: string\n\n    # ---- Repair ----\n    RepairResponse:\n      type: object\n      properties:\n        journal_id:\n          type: string\n        repaired:\n          type: boolean\n        message:\n          type: string\n        correlation_id:\n          type: string\n\n    # ---- Overdraft ----\n    OverdraftFacilityRequest:\n      type: object\n      required: [account_id, limit_amount, currency]\n      properties:\n        account_id:\n          type: string\n        limit_amount:\n          type: string\n        currency:\n          $ref: '#/components/schemas/CurrencyCode'\n        correlation_id:\n          type: string\n\n    OverdraftRequestResponse:\n      type: object\n      properties:\n        facility_id:\n          type: string\n        request_id:\n          type: string\n        state:\n          type: string\n        correlation_id:\n          type: string\n\n    OverdraftActionResponse:\n      type: object\n      properties:\n        request_id:\n          type: string\n        state:\n          $ref: '#/components/schemas/ApprovalStatus'\n        correlation_id:\n          type: string\n\n    OverdraftFacility:\n      type: object\n      properties:\n        id:\n          type: string\n        account_id:\n          type: string\n        limit_amount:\n          type: string\n        currency:\n          $ref: '#/components/schemas/CurrencyCode'\n        state:\n          type: string\n          enum: [PENDING, ACTIVE, REJECTED]\n        maker_staff_id:\n          type: string\n        checker_staff_id:\n          type: string\n        created_at:\n          type: string\n          format: date-time\n";
